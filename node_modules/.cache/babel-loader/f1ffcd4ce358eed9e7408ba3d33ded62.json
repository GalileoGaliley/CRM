{"ast":null,"code":"import _objectSpread from\"/Users/nicole/rrrr/crm/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/Users/nicole/rrrr/crm/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/nicole/rrrr/crm/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/nicole/rrrr/crm/node_modules/@babel/runtime/regenerator/index.js\";import React,{useEffect,useState}from\"react\";import{connect}from\"react-redux\";import{httpClient,nError}from\"../../funcs\";import{mapDispatchToProps,mapStateToProps}from\"../../store\";import Datetime from'react-datetime';import\"../../styles/pages/common/entity-edit.sass\";import moment from\"moment\";import Select from\"../../components/Select\";import Checkbox from\"../../components/Checkbox\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var AbsencesPage_Item=connect(mapStateToProps,mapDispatchToProps)(function(props){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),readyToSave=_useState2[0],setReadyToSave=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),editing=_useState4[0],setEditing=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),deleting=_useState6[0],setDeleting=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),readyToDelete=_useState8[0],setReadyToDelete=_useState8[1];var _useState9=useState(null),_useState10=_slicedToArray(_useState9,2),absenceData=_useState10[0],setAbsenceData=_useState10[1];var _useState11=useState({}),_useState12=_slicedToArray(_useState11,2),newAbsenceData=_useState12[0],setNewAbsenceData=_useState12[1];// Load info function\nfunction loadInfo(){return _loadInfo.apply(this,arguments);}// Load absence data\nfunction _loadInfo(){_loadInfo=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _ref,_absenceData;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return httpClient.get('/absences');case 3:_ref=_context.sent;_absenceData=_ref.data;setAbsenceData(_absenceData);setNewAbsenceData(_objectSpread(_objectSpread({},_absenceData.absence),{},{absence_start:new Date(_absenceData.absence.absence_start),absence_end:new Date(_absenceData.absence.absence_end)}));setTimeout(function(){return setReadyToSave(false);},100);_context.next=13;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](0);nError(_context.t0);case 13:case\"end\":return _context.stop();}}},_callee,null,[[0,10]]);}));return _loadInfo.apply(this,arguments);}useEffect(function(){loadInfo();},[]);useEffect(function(){return setReadyToSave(true);},[newAbsenceData]);// Handle service resource changing\nuseEffect(function(){var _absenceData$edit$fin;var sr=newAbsenceData.service_resource;if(!absenceData)return;setAbsenceData(_objectSpread(_objectSpread({},absenceData),{},{absence:_objectSpread(_objectSpread({},absenceData.absence),{},{area:(_absenceData$edit$fin=absenceData.edit.find(function(item){return item.service_resource===sr;}))===null||_absenceData$edit$fin===void 0?void 0:_absenceData$edit$fin.area})}));},[newAbsenceData.service_resource]);// Render function\nreturn/*#__PURE__*/_jsx(_Fragment,{children:absenceData&&newAbsenceData.absence_start?/*#__PURE__*/_jsxs(\"div\",{className:\"AbsencesPage_Item entity-edit\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"wrapper flex-container sb\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Absence\"}),absenceData!==null&&absenceData!==void 0&&absenceData.permissions.edit_absence&&!editing?/*#__PURE__*/_jsx(\"button\",{className:\"_wa _green\",onClick:function onClick(){return setEditing(true);},children:\"Edit\"}):null]}),/*#__PURE__*/_jsxs(\"div\",{className:\"fieldset\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"legend\",children:\"Main\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"fields\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"__left\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"field\",style:{zIndex:6},children:[/*#__PURE__*/_jsx(\"span\",{children:\"Service resource:\"}),/*#__PURE__*/_jsx(Select,{disabled:!editing,options:absenceData.edit.map(function(option){return{span:option.service_resource,value:option.service_resource};}),selectedOption:newAbsenceData.service_resource,onChange:function onChange(value){return setNewAbsenceData(_objectSpread(_objectSpread({},newAbsenceData),{},{service_resource:value}));}})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"field\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Area:\"}),/*#__PURE__*/_jsx(Select,{disabled:true,options:absenceData.edit.map(function(option){return{span:option.area,value:option.area};}),selectedOption:absenceData.absence.area,onChange:function onChange(value){return setAbsenceData(_objectSpread(_objectSpread({},absenceData),{},{absence:_objectSpread(_objectSpread({},absenceData.absence),{},{area:value})}));}})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"__right\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"field\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Absence start:\"}),/*#__PURE__*/_jsx(Datetime,{inputProps:{disabled:!editing},value:newAbsenceData.absence_start,onChange:function onChange(value){return setNewAbsenceData(_objectSpread(_objectSpread({},newAbsenceData),{},{absence_start:moment.isMoment(value)?value.toDate():absenceData.absence.absence_start}));}})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"field\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Absence end:\"}),/*#__PURE__*/_jsx(Datetime,{inputProps:{disabled:!editing},value:newAbsenceData.absence_end,onChange:function onChange(value){return setNewAbsenceData(_objectSpread(_objectSpread({},newAbsenceData),{},{absence_end:moment.isMoment(value)?value.toDate():absenceData.absence.absence_end}));}})]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"fieldset\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"legend\",children:\"Info\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"fields\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"__left\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"field\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Date Created:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",defaultValue:absenceData===null||absenceData===void 0?void 0:absenceData.absence.created_at,disabled:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"field\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Created by:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",defaultValue:absenceData===null||absenceData===void 0?void 0:absenceData.absence.created_by,disabled:true})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"__right\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"field\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Last Edited:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",defaultValue:absenceData===null||absenceData===void 0?void 0:absenceData.absence.last_edited_at,disabled:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"field\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Last Edited By:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",defaultValue:absenceData===null||absenceData===void 0?void 0:absenceData.absence.last_edited_by,disabled:true})]})]})]})]}),editing?/*#__PURE__*/_jsxs(\"div\",{className:\"wrapper flex-container sb editing-buttons\",children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"button\",{className:\"_red\",onClick:function onClick(){return setDeleting(true);},children:\"Delete Absence\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"buttons\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"_bordered _red\",onClick:function onClick(){return setEditing(false);},children:\"Cancel\"}),/*#__PURE__*/_jsx(\"button\",{disabled:!readyToSave,className:\"_bordered _green\",children:\"Save\"})]})]}):null,deleting?/*#__PURE__*/_jsx(\"div\",{className:\"item-delete-popup\",onClick:function onClick(){return setDeleting(false);},children:/*#__PURE__*/_jsxs(\"div\",{className:\"wrapper\",onClick:function onClick(e){return e.stopPropagation();},children:[/*#__PURE__*/_jsx(\"div\",{className:\"title\",children:\"Delete Absence\"}),/*#__PURE__*/_jsx(\"div\",{className:\"checkbox-wrapper\",children:/*#__PURE__*/_jsx(Checkbox,{contents:\"I understand that after deleting the absence it will not be possible to recover.\",value:readyToDelete,onChange:function onChange(value){return setReadyToDelete(value);}})}),/*#__PURE__*/_jsxs(\"div\",{className:\"buttons\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"_bordered _green\",onClick:function onClick(){return setDeleting(false);},children:\"Cancel\"}),/*#__PURE__*/_jsx(\"button\",{disabled:!readyToDelete,className:\"_bordered _red\",children:\"Delete\"})]})]})}):null]}):null});});export default AbsencesPage_Item;","map":{"version":3,"sources":["/Users/nicole/rrrr/crm/src/pages/Absences/Item.tsx"],"names":["React","useEffect","useState","connect","httpClient","nError","mapDispatchToProps","mapStateToProps","Datetime","moment","Select","Checkbox","AbsencesPage_Item","props","readyToSave","setReadyToSave","editing","setEditing","deleting","setDeleting","readyToDelete","setReadyToDelete","absenceData","setAbsenceData","newAbsenceData","setNewAbsenceData","loadInfo","get","data","absence","absence_start","Date","absence_end","setTimeout","sr","service_resource","area","edit","find","item","permissions","edit_absence","zIndex","map","option","span","value","disabled","isMoment","toDate","created_at","created_by","last_edited_at","last_edited_by","e","stopPropagation"],"mappings":"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","sourcesContent":["import axios from \"axios\"\nimport React, { useEffect, useState } from \"react\";\nimport { connect } from \"react-redux\";\nimport Icon from \"../../components/Icon\"\nimport {httpClient, nError} from \"../../funcs\"\nimport Absence from \"../../models/Absence\"\nimport { StoreDispatch, StoreState, mapDispatchToProps, mapStateToProps } from \"../../store\";\nimport Datetime from 'react-datetime'\n\nimport \"../../styles/pages/common/entity-edit.sass\"\nimport moment from \"moment\"\nimport Select from \"../../components/Select\"\nimport Checkbox from \"../../components/Checkbox\"\n\ninterface Props {\n  store: StoreState,\n  dispatcher: StoreDispatch\n}\n\ninterface AbsenceData {\n  \n  permissions: {\n    \n    edit_absence: boolean,\n  },\n\n  absence: Absence,\n\n  edit: {\n    service_resource: string,\n    area: string\n  }[]\n}\n\nconst AbsencesPage_Item = connect(mapStateToProps, mapDispatchToProps)(function(props: Props) {\n\n  const [readyToSave, setReadyToSave] = useState(false)\n\n  const [editing, setEditing] = useState(false)\n\n  const [deleting, setDeleting] = useState(false)\n  const [readyToDelete, setReadyToDelete] = useState(false)\n  \n  const [absenceData, setAbsenceData] = useState<AbsenceData | null>(null)\n\n  const [newAbsenceData, setNewAbsenceData] = useState<Partial<Absence>>({\n    \n  })\n  \n  // Load info function\n  async function loadInfo() {\n    try {\n      const { data: absenceData } = (await httpClient.get('/absences')) as {data: AbsenceData}\n\n      setAbsenceData(absenceData)\n\n      setNewAbsenceData({\n        ...absenceData.absence,\n        absence_start: new Date(absenceData.absence.absence_start),\n        absence_end: new Date(absenceData.absence.absence_end),\n      })\n\n      setTimeout(() => setReadyToSave(false), 100)\n    }\n    catch (error) {\n      nError(error)\n    }\n  }\n\n  // Load absence data\n  useEffect(() => {\n    loadInfo()\n  }, [])\n\n  useEffect(() => setReadyToSave(true), [\n    newAbsenceData\n  ])\n\n  // Handle service resource changing\n  useEffect(() => {\n\n    let sr = newAbsenceData.service_resource\n\n    if (!absenceData) return\n    \n    setAbsenceData({\n      ...absenceData,\n      absence: {\n        ...absenceData.absence,\n        area: absenceData.edit.find((item) => item.service_resource === sr)?.area as string\n      }\n    })\n\n  }, [newAbsenceData.service_resource])\n  \n  // Render function\n  return (<>\n    {absenceData && newAbsenceData.absence_start ? (\n      <div className=\"AbsencesPage_Item entity-edit\">\n\n        <div className=\"wrapper flex-container sb\">\n          <h1>Absence</h1>\n\n          {absenceData?.permissions.edit_absence && !editing ? (\n            <button className=\"_wa _green\" onClick={() => setEditing(true)}>\n              Edit\n            </button>\n          ) : null}\n        </div>\n        \n        <div className=\"fieldset\">\n          \n          <div className=\"legend\">Main</div>\n\n          <div className=\"fields\">\n\n            <div className=\"__left\">\n              <div className=\"field\" style={{zIndex: 6}}>\n                <span>Service resource:</span>\n                <Select disabled={!editing} options={absenceData.edit.map((option) => ({\n                  span: option.service_resource,\n                  value: option.service_resource\n                }))} selectedOption={newAbsenceData.service_resource as string} onChange={(value) => setNewAbsenceData({...newAbsenceData, service_resource: value as string})}/>\n              </div>\n\n              <div className=\"field\">\n                <span>Area:</span>\n                <Select disabled={true} options={absenceData.edit.map((option) => ({\n                  span: option.area,\n                  value: option.area\n                }))} selectedOption={absenceData.absence.area} onChange={(value) => setAbsenceData({...absenceData, absence: {...absenceData.absence, area: value as string}})}/>\n              </div>\n            </div>\n\n            \n            <div className=\"__right\">\n\n              <div className=\"field\">\n                <span>Absence start:</span>\n                <Datetime inputProps={{ disabled: !editing }} value={newAbsenceData.absence_start as Date} onChange={(value) => setNewAbsenceData({...newAbsenceData, absence_start: moment.isMoment(value) ? value.toDate() : (absenceData as AbsenceData).absence.absence_start})} />\n              </div>\n\n              <div className=\"field\">\n                <span>Absence end:</span>\n                <Datetime inputProps={{ disabled: !editing }} value={newAbsenceData.absence_end as Date} onChange={(value) => setNewAbsenceData({...newAbsenceData, absence_end: moment.isMoment(value) ? value.toDate() : (absenceData as AbsenceData).absence.absence_end})} />\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"fieldset\">\n          \n          <div className=\"legend\">Info</div>\n\n          <div className=\"fields\">\n\n            <div className=\"__left\">\n              <div className=\"field\">\n                <span>Date Created:</span>\n                <input type=\"text\" defaultValue={absenceData?.absence.created_at} disabled={ true } />\n              </div>\n\n              <div className=\"field\">\n                <span>Created by:</span>\n                <input type=\"text\" defaultValue={absenceData?.absence.created_by} disabled={ true } />\n              </div>\n            </div>\n\n            \n            <div className=\"__right\">\n\n              <div className=\"field\">\n                <span>Last Edited:</span>\n                <input type=\"text\" defaultValue={absenceData?.absence.last_edited_at} disabled={ true } />\n              </div>\n\n              <div className=\"field\">\n                <span>Last Edited By:</span>\n                <input type=\"text\" defaultValue={absenceData?.absence.last_edited_by} disabled={ true } />\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {editing ? (\n          <div className=\"wrapper flex-container sb editing-buttons\">\n            <div>\n              <button className=\"_red\" onClick={() => setDeleting(true)}>Delete Absence</button>\n            </div>\n            <div className=\"buttons\">\n              <button className=\"_bordered _red\" onClick={() => setEditing(false)}>\n                Cancel\n              </button>\n              <button disabled={!readyToSave} className=\"_bordered _green\">\n                Save\n              </button>\n            </div>\n          </div>\n        ) : null}\n\n        {/* Item share popup */}\n        {deleting ? (\n          <div className=\"item-delete-popup\" onClick={() => setDeleting(false)}>\n\n            <div className=\"wrapper\" onClick={(e) => e.stopPropagation()}>\n            \n              <div className=\"title\">\n                Delete Absence\n              </div>\n\n              <div className=\"checkbox-wrapper\">\n                <Checkbox contents=\"I understand that after deleting the absence it will not be possible to recover.\" value={readyToDelete} onChange={(value) => setReadyToDelete(value)} />\n              </div>\n\n              <div className=\"buttons\">\n\n                <button className=\"_bordered _green\" onClick={() => setDeleting(false)}>\n                  Cancel\n                </button>\n\n                <button disabled={!readyToDelete} className=\"_bordered _red\">\n                  Delete\n                </button>\n              </div>\n            </div>\n          </div>\n        ) : null}\n      </div>\n    ) : null}\n  </>)\n})\nexport default AbsencesPage_Item\n"]},"metadata":{},"sourceType":"module"}