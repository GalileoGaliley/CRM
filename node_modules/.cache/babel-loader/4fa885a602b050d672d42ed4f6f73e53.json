{"ast":null,"code":"var _jsxFileName = \"/Users/nicole/rrrr/crm/src/pages/Auth.tsx\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState } from \"react\";\nimport { connect } from \"react-redux\";\nimport Icon from \"../components/Icon\";\nimport { httpClient, nError } from \"../funcs\";\nimport businessAccountIconImg from \"../images/business-account_icon.svg\";\nimport logoImg from \"../images/logo.svg\";\nimport { mapDispatchToProps, mapStateToProps } from \"../store\";\nimport \"../styles/pages/auth.sass\";\nimport qs from \"qs\";\nimport { useRoute } from \"react-router5\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AuthPage = connect(mapStateToProps, mapDispatchToProps)(_s(function AuthPage(props) {\n  var _authData$accounts;\n\n  _s();\n\n  const $router = useRoute();\n  const [mode, setMode] = useState($router.route.params.mode);\n  const [errorText, setErrorText] = useState(null);\n  const [authData, setAuthData] = useState({\n    accessToken: null,\n    accounts: [],\n    selectedAccount: null,\n    user: null\n  });\n  const [authForm, setAuthForm] = useState({\n    $disabled: false,\n    email: \"\",\n    password: \"\"\n  }); // Auth function\n\n  const aaa = async () => {\n    await httpClient.post('/users', qs.stringify({\n      email: 'user3756@mail.ru',\n      password: '12345678!asd',\n      first_name: 'Fillipp',\n      last_name: 'Preobrazshensky',\n      position: developer\n    }), {\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded'\n      }\n    }).then(data => {\n      console.log(data);\n    });\n  };\n\n  async function auth() {\n    // Reset error text\n    setErrorText(null); // Prevent from sending form again\n\n    setAuthForm({ ...authForm,\n      $disabled: false\n    }); // Fetch form data\n\n    const {\n      email,\n      password\n    } = authForm;\n    console.log(email);\n    console.log(password);\n    console.log(authForm);\n\n    try {\n      // Validate input data\n      const validationErrors = [{\n        displayFieldText: \"E-Mail\",\n        entity: email,\n        rule: \"email\"\n      }, {\n        displayFieldText: \"Password\",\n        entity: password,\n        rule: \"password\"\n      }];\n      if (validationErrors.length) throw new Error(validationErrors.join(\"\\n\")); // Perform autorization\n\n      const {\n        data: {\n          token: accessToken\n        }\n      } = await httpClient.post('/login', qs.stringify({\n        email,\n        password\n      }), {\n        headers: {\n          'Content-Type': 'application/x-www-form-urlencoded'\n        }\n      });\n      httpClient.defaults.headers['Authorization'] = `Bearer ${accessToken}`; // Get accounts list\n\n      const {\n        data: {\n          accounts\n        }\n      } = await httpClient.get('/accounts'); // Save info\n\n      setAuthData({\n        accessToken: accessToken,\n        accounts\n      }); // Show select account menu\n\n      $router.router.navigate('auth', {\n        mode: \"account-select\"\n      }, {\n        reload: true\n      });\n    } catch (error) {\n      console.log(error);\n      setErrorText(nError(error).content.errorText);\n    } finally {\n      setAuthForm({ ...authForm,\n        $disabled: false\n      });\n    }\n  } // Select account function\n\n\n  async function selectAccount(i) {\n    props.dispatcher.setAccessToken(authData.accessToken);\n    props.dispatcher.setAccounts(authData.accounts);\n    props.dispatcher.setSelectedAccount(i);\n    httpClient.defaults.headers['Authorization'] = `Bearer ${props.store.accessToken}`;\n  } // Handle mode\n\n\n  useEffect(() => {\n    setMode($router.route.params.mode);\n  }, [$router.route.params.mode]); // Handle account select on page mount\n\n  useEffect(() => {\n    if (props.store.accessToken) {\n      httpClient.get('/accounts').then(_ref => {\n        let {\n          data: {\n            accounts\n          }\n        } = _ref;\n        setAuthData({ ...authData,\n          accessToken: props.store.accessToken,\n          accounts\n        });\n      });\n    }\n  }, []); // Render function\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"AuthPage\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"ProjectHeaders\",\n      onClick: () => mode != 'account-select' && $router.router.navigate('auth', {\n        mode: 'auth'\n      }, {\n        reload: true\n      }),\n      children: [/*#__PURE__*/_jsxDEV(\"img\", {\n        src: logoImg,\n        alt: \"\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 148,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"headers\",\n        children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n          children: \"Expert @ FS\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 151,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n          children: \"Manage your business!\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 152,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 150,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"auth-wrapper\",\n      children: [mode === \"auth\" ? /*#__PURE__*/_jsxDEV(\"form\", {\n        onSubmit: e => {\n          e.preventDefault();\n          auth();\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          children: \"Sign In\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 162,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"__form-field\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"label\",\n            children: \"E-Mail:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 165,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"text\",\n            onChange: _ref2 => {\n              let {\n                target: {\n                  value\n                }\n              } = _ref2;\n              return setAuthForm({ ...authForm,\n                email: value\n              });\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 166,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 164,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"__form-field\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"label\",\n            children: \"Password:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 169,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"password\",\n            onChange: _ref3 => {\n              let {\n                target: {\n                  value\n                }\n              } = _ref3;\n              return setAuthForm({ ...authForm,\n                password: value\n              });\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 170,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 168,\n          columnNumber: 13\n        }, this), errorText ? /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"errorText\",\n          children: errorText\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 177,\n          columnNumber: 15\n        }, this) : null, /*#__PURE__*/_jsxDEV(\"button\", {\n          type: \"button\",\n          className: \"_zeroed password-reset-link\",\n          onClick: () => $router.router.navigate('auth', {\n            mode: 'password-reset'\n          }, {\n            reload: true\n          }),\n          children: \"Forgot password?\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 180,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          type: 'button',\n          onClick: () => {\n            aaa();\n          },\n          children: \"aaaaaa\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 187,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"_wa __submit\",\n          children: \"Sign In\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 188,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 161,\n        columnNumber: 11\n      }, this) : null, mode === \"password-reset\" ? /*#__PURE__*/_jsxDEV(\"form\", {\n        onSubmit: e => e.preventDefault(),\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          children: \"Reset Password\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 197,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: \"Enter your E-Mail and we will send the link:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 199,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"__form-field\",\n          children: /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"text\",\n            placeholder: \"Your E-Mail...\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 204,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 203,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"_wa __submit\",\n          children: \"Submit\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 207,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 196,\n        columnNumber: 11\n      }, this) : null, mode === \"account-select\" ? /*#__PURE__*/_jsxDEV(\"form\", {\n        onSubmit: e => e.preventDefault(),\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"account-select\",\n          children: (_authData$accounts = authData.accounts) === null || _authData$accounts === void 0 ? void 0 : _authData$accounts.map((account, i) => /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"account\",\n            onClick: () => selectAccount(i),\n            \"aria-hidden\": \"true\",\n            children: [/*#__PURE__*/_jsxDEV(\"img\", {\n              src: businessAccountIconImg,\n              alt: \"\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 221,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              children: account.name\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 222,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"stats-signs\",\n              children: [/*#__PURE__*/_jsxDEV(Icon, {\n                icon: \"bell-1\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 225,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(Icon, {\n                icon: \"help-1\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 226,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 224,\n              columnNumber: 19\n            }, this)]\n          }, i, true, {\n            fileName: _jsxFileName,\n            lineNumber: 220,\n            columnNumber: 17\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 217,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 215,\n        columnNumber: 11\n      }, this) : null]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 157,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 144,\n    columnNumber: 5\n  }, this);\n}, \"vvH5IG8dMpD5mg9dXRRv+eq19Y8=\", false, function () {\n  return [useRoute];\n}));\nexport default AuthPage;","map":{"version":3,"sources":["/Users/nicole/rrrr/crm/src/pages/Auth.tsx"],"names":["React","useEffect","useState","connect","Icon","httpClient","nError","mapDispatchToProps","mapStateToProps","qs","useRoute","AuthPage","props","$router","mode","setMode","route","params","errorText","setErrorText","authData","setAuthData","accessToken","accounts","selectedAccount","user","authForm","setAuthForm","$disabled","email","password","aaa","post","stringify","first_name","last_name","position","developer","headers","then","data","console","log","auth","validationErrors","displayFieldText","entity","rule","length","Error","join","token","defaults","get","router","navigate","reload","error","content","selectAccount","i","dispatcher","setAccessToken","setAccounts","setSelectedAccount","store","logoImg","e","preventDefault","target","value","map","account","businessAccountIconImg","name"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { connect } from \"react-redux\";\nimport Icon from \"../components/Icon\"\nimport { httpClient, nError } from \"../funcs\"\nimport businessAccountIconImg from \"../images/business-account_icon.svg\"\n\nimport logoImg from \"../images/logo.svg\"\n\nimport Account from \"../models/Account\"\nimport { StoreDispatch, StoreState, mapDispatchToProps, mapStateToProps } from \"../store\";\n\nimport \"../styles/pages/auth.sass\"\nimport { validateMany } from \"../validate\"\n\nimport qs from \"qs\"\nimport { useRoute } from \"react-router5\"\nimport User from \"../models/User\"\nimport Menus from \"../models/Menus\"\n\n\ninterface Props {\n  store: StoreState,\n  dispatcher: StoreDispatch\n}\n\nconst AuthPage = connect(mapStateToProps, mapDispatchToProps)(function AuthPage(props: Props) {\n\n  const $router = useRoute()\n\n  const [mode, setMode] = useState<\"auth\" | \"password-reset\" | \"account-select\">($router.route.params.mode)\n  const [errorText, setErrorText] = useState<string | null>(null)\n  const [authData, setAuthData] = useState<Partial<StoreState>>({\n    accessToken: null,\n    accounts: [],\n    selectedAccount: null,\n    user: null\n  })\n  const [authForm, setAuthForm] = useState({\n    $disabled: false,\n\n    email: \"\",\n    password: \"\"\n  })\n\n  // Auth function\n  const aaa = async ()=>{\n\n    await httpClient.post('/users', qs.stringify({ email:'user3756@mail.ru', password:'12345678!asd', first_name:'Fillipp',last_name:'Preobrazshensky',position: developer }), {\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded'\n      }\n\n    }).then((data)=>{\n      console.log(data)\n    })\n\n\n  }\n  async function auth() {\n\n    // Reset error text\n    setErrorText(null)\n\n    // Prevent from sending form again\n    setAuthForm({ ...authForm, $disabled: false })\n\n    // Fetch form data\n    const { email, password } = authForm\n    console.log(email)\n    console.log(password)\n    console.log(authForm)\n    try {\n\n      // Validate input data\n      const validationErrors = ([\n        { displayFieldText: \"E-Mail\", entity: email, rule: \"email\" },\n        { displayFieldText: \"Password\", entity: password, rule: \"password\" }\n      ])\n      if (validationErrors.length)\n        throw new Error(validationErrors.join(\"\\n\"))\n\n      // Perform autorization\n      const { data: { token: accessToken } } = await httpClient.post('/login', qs.stringify({ email, password }), {\n        headers: {\n          'Content-Type': 'application/x-www-form-urlencoded'\n        }\n      })\n      httpClient.defaults.headers['Authorization'] = `Bearer ${accessToken}`\n\n      // Get accounts list\n      const { data: { accounts }} = await httpClient.get('/accounts')\n\n      // Save info\n      setAuthData({\n        accessToken: accessToken,\n        accounts\n      })\n\n      // Show select account menu\n      $router.router.navigate('auth', {\n        mode: \"account-select\"\n      }, {reload: true})\n    }\n    catch (error) {\n      console.log(error)\n      setErrorText(nError(error).content.errorText)\n    }\n    finally {\n      setAuthForm({ ...authForm, $disabled: false })\n    }\n  }\n\n  // Select account function\n  async function selectAccount(i: number) {\n\n    props.dispatcher.setAccessToken(authData.accessToken as string | null)\n    props.dispatcher.setAccounts(authData.accounts as Account[])\n    props.dispatcher.setSelectedAccount(i)\n\n    httpClient.defaults.headers['Authorization'] = `Bearer ${props.store.accessToken}`\n  }\n\n  // Handle mode\n  useEffect(() => {\n    setMode($router.route.params.mode)\n  }, [$router.route.params.mode])\n\n  // Handle account select on page mount\n  useEffect(() => {\n    \n    if (props.store.accessToken) {\n      httpClient.get('/accounts').then(({ data: { accounts }}) => {\n        setAuthData({\n          ...authData,\n          accessToken: props.store.accessToken,\n          accounts\n        })\n      })\n    }\n  }, [])\n\n  // Render function\n  return (\n    <div className=\"AuthPage\">\n      \n      { /* Project about */ }\n      <div className=\"ProjectHeaders\" onClick={ () => mode != 'account-select' && $router.router.navigate('auth', {mode: 'auth'}, {reload: true}) }>\n        <img src={ logoImg } alt=\"\" />\n\n        <div className=\"headers\">\n          <h1>Expert @ FS</h1>\n          <h2>Manage your business!</h2>\n        </div>\n      </div>\n\n      { /* Auth wrapper */ }\n      <div className=\"auth-wrapper\">\n\n        { /* Auth form */ }\n        { mode === \"auth\" ? (\n          <form onSubmit={ (e) => {e.preventDefault(); auth()} }>\n            <h2>Sign In</h2>\n\n            <div className=\"__form-field\">\n              <div className=\"label\">E-Mail:</div>\n              <input type=\"text\" onChange={ ({ target: { value } }) => setAuthForm({ ...authForm, email: value }) } />\n            </div>\n            <div className=\"__form-field\">\n              <div className=\"label\">Password:</div>\n              <input\n                type=\"password\"\n                onChange={ ({ target: { value } }) => setAuthForm({ ...authForm, password: value }) }\n              />\n            </div>\n\n            { errorText ? (\n              <div className=\"errorText\">{ errorText }</div>\n            ) : null }\n\n            <button\n              type=\"button\"\n              className=\"_zeroed password-reset-link\"\n              onClick={ () => $router.router.navigate('auth', {mode: 'password-reset'}, {reload: true}) }\n            >\n              Forgot password?\n            </button>\n            <button type={'button'} onClick={()=>{aaa()}}>aaaaaa</button>\n            <button className=\"_wa __submit\" >\n              Sign In\n            </button>\n          </form>\n        ) : null }\n        \n        { /* Password reset form */ }\n        { mode === \"password-reset\" ? (\n          <form onSubmit={ (e) => e.preventDefault() }>\n            <h2>Reset Password</h2>\n\n            <p>\n              Enter your E-Mail and we will send the link:\n            </p>\n\n            <div className=\"__form-field\">\n              <input type=\"text\" placeholder=\"Your E-Mail...\" />\n            </div>\n\n            <button className=\"_wa __submit\">\n              Submit\n            </button>\n          </form>\n        ) : null }\n        \n        { /* Select account form */ }\n        { mode === \"account-select\" ? (\n          <form onSubmit={ (e) => e.preventDefault() }>\n\n            <div className=\"account-select\">\n\n              { authData.accounts?.map((account, i) => (\n                <div className=\"account\" key={ i } onClick={ () => selectAccount(i) } aria-hidden=\"true\">\n                  <img src={ businessAccountIconImg } alt=\"\" />\n                  <span>{ account.name }</span>\n\n                  <div className=\"stats-signs\">\n                    <Icon icon=\"bell-1\"/>\n                    <Icon icon=\"help-1\"/>\n                  </div>\n                </div>\n              )) }\n            </div>\n          </form>\n        ) : null }\n      </div>\n    </div>\n  )\n})\nexport default AuthPage\n"]},"metadata":{},"sourceType":"module"}