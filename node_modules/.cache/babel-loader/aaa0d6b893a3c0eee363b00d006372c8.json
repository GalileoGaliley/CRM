{"ast":null,"code":"import _defineProperty from\"/Users/nicole/rrrr/crm/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _objectSpread from\"/Users/nicole/rrrr/crm/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _toConsumableArray from\"/Users/nicole/rrrr/crm/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _asyncToGenerator from\"/Users/nicole/rrrr/crm/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/nicole/rrrr/crm/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/nicole/rrrr/crm/node_modules/@babel/runtime/regenerator/index.js\";import classNames from\"classnames\";import{useEffect,useState}from\"react\";import{connect}from\"react-redux\";import{useRoute}from\"react-router5\";import Icon from\"../../components/Icon\";import ReportFilters from\"../../components/reports/Filters\";import ReportTableControls from\"../../components/reports/TableControls\";import ReportTableField from\"../../components/reports/TableField\";import{getActiveAccount,httpClient,nError}from\"../../funcs\";import{mapDispatchToProps,mapStateToProps}from\"../../store\";import\"../../styles/pages/common/report-list.sass\";import qs from\"qs\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var ClientsPage_List=connect(mapStateToProps,mapDispatchToProps)(function(props){var $router=useRoute();var activeAccount=getActiveAccount(props.store);var _useState=useState(Math.random()),_useState2=_slicedToArray(_useState,2),$updater=_useState2[0],$setUpdater=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),reportData=_useState4[0],setReportData=_useState4[1];var _useState5=useState({search:'',page:1,max_rows:100,filter_words:{source:[]},sort:{field:'name',direction:'up'},sortFields:[{span:'Name',value:'name'},{span:'Date',value:'created_at'},{span:'Main Phone',value:'phone'},{span:'Source',value:'source'},{span:'Jobs',value:'jobs'},{span:'Appointments',value:'appointments'},{span:'Recalls',value:'recalls'},{span:'Total',value:'total'},{span:'Paid',value:'paid'},{span:'Unpaid',value:'unpaid'}]}),_useState6=_slicedToArray(_useState5,2),localInterface=_useState6[0],setLocalInterface=_useState6[1];// Load clients function\nfunction loadClients(){return _loadClients.apply(this,arguments);}// Load clients on page mount\nfunction _loadClients(){_loadClients=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var activeFilters,reqData,_ref,clients;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:activeFilters=_objectSpread({},localInterface.filter_words);Object.keys(localInterface.filter_words).forEach(function(key){return!activeFilters[key].length&&delete activeFilters[key];});reqData=_objectSpread({account_id:activeAccount.account_id,limit_rows:props.store.reportsMaxRows,page:localInterface.page,sort_field:localInterface.sort.field,sort_type:localInterface.sort.direction==='up'?'asc':'desc',filter_field:JSON.stringify(activeFilters)},localInterface.search?{search:localInterface.search}:{});_context.prev=3;_context.next=6;return httpClient.post('/clients/report',qs.stringify(reqData));case 6:_ref=_context.sent;clients=_ref.data;console.log(clients);setReportData(clients);_context.next=15;break;case 12:_context.prev=12;_context.t0=_context[\"catch\"](3);nError(_context.t0);case 15:case\"end\":return _context.stop();}}},_callee,null,[[3,12]]);}));return _loadClients.apply(this,arguments);}useEffect(function(){loadClients();},[$updater,localInterface.page]);// Is filter selected function\nfunction isFilterSelected(field,value){return localInterface.filter_words[field].includes(value);}function isAllFiltersSelected(field){return localInterface.filter_words[field].length===0;}function switchFilter(field,value,toggle){var _arr=_toConsumableArray(localInterface.filter_words[field]);if(toggle&&value===\"All\"){_arr=[];}else if(!toggle){while(true){var i=_arr.findIndex(function(filter){return filter===value;});if(i===-1)break;_arr.splice(i,1);}}else{if(reportData!==null&&reportData!==void 0&&reportData.interface.filter_words[field].every(function(option){return _arr.concat([value]).includes(option);}))_arr=[];else if(_arr.findIndex(function(filter){return filter===value;})===-1)_arr.push(value);}setLocalInterface(_objectSpread(_objectSpread({},localInterface),{},{filter_words:_objectSpread(_objectSpread({},localInterface.filter_words),{},_defineProperty({},field,_arr))}));}// Render function\nreturn/*#__PURE__*/_jsx(_Fragment,{children:reportData?/*#__PURE__*/_jsxs(\"div\",{className:\"ClientsPage_List\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"reports-grid\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"cell\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"amount\",children:reportData.dashboard.all}),/*#__PURE__*/_jsx(\"div\",{className:\"legend\",children:\"All Clients\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"cell\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"amount\",children:reportData.dashboard.unpaid}),/*#__PURE__*/_jsx(\"div\",{className:\"legend\",children:\"Unpaid\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"cell\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"amount\",children:reportData.dashboard.new_this_month}),/*#__PURE__*/_jsx(\"div\",{className:\"legend\",children:\"New This Month\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"cell\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"amount\",children:reportData.dashboard.new_last_month}),/*#__PURE__*/_jsx(\"div\",{className:\"legend\",children:\"New Last Month\"})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"page-header\",children:/*#__PURE__*/_jsx(\"h1\",{children:\"Clients\"})}),/*#__PURE__*/_jsx(ReportFilters,{onSearchInputChange:function onSearchInputChange(value){return setLocalInterface(_objectSpread(_objectSpread({},localInterface),{},{search:value}));},onUpdate:function onUpdate(){$setUpdater(Math.random());}}),/*#__PURE__*/_jsx(ReportTableControls,{zIndex:5,onMaxRowsChange:function onMaxRowsChange(){$setUpdater(Math.random());},amount:{total:reportData.interface.rows_all,start:reportData.interface.rows_start,end:reportData.interface.rows_end},page:localInterface.page,maxPages:reportData.interface.max_pages,onPagesStart:function onPagesStart(){return setLocalInterface(_objectSpread(_objectSpread({},localInterface),{},{page:1}));},onPrevPage:function onPrevPage(){return setLocalInterface(_objectSpread(_objectSpread({},localInterface),{},{page:localInterface.page-1}));},onNextPage:function onNextPage(){return setLocalInterface(_objectSpread(_objectSpread({},localInterface),{},{page:localInterface.page+1}));},onPagesEnd:function onPagesEnd(){return setLocalInterface(_objectSpread(_objectSpread({},localInterface),{},{page:reportData.interface.max_pages}));},sort:localInterface.sort,sortFields:localInterface.sortFields,onSortFieldChange:function onSortFieldChange(value){return setLocalInterface(_objectSpread(_objectSpread({},localInterface),{},{sort:_objectSpread(_objectSpread({},localInterface.sort),{},{field:value})}));},onSortDirectionChange:function onSortDirectionChange(value){return setLocalInterface(_objectSpread(_objectSpread({},localInterface),{},{sort:_objectSpread(_objectSpread({},localInterface.sort),{},{direction:value})}));},onSortFire:function onSortFire(){return 0;},addButton:/*#__PURE__*/_jsx(\"div\",{className:\"add-button-wrapper\",children:/*#__PURE__*/_jsxs(\"button\",{className:\"_iconed _rounded add-button\",onClick:function onClick(){return $router.router.navigate('clients.new',{},{reload:true});},children:[/*#__PURE__*/_jsx(Icon,{icon:\"plus-thin\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Add Client\"}),/*#__PURE__*/_jsx(Icon,{icon:\"user-29\"})]})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"contents\",children:[/*#__PURE__*/_jsxs(\"table\",{className:classNames('table','__show-on-wide',{__respectAsidePanel:props.store.navActive.is}),children:[/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(ReportTableField,{contents:/*#__PURE__*/_jsx(\"span\",{children:\"Name\"}),sortDirection:localInterface.sort.field==='name'?localInterface.sort.direction:undefined,onSortDirectionChange:function onSortDirectionChange(value){return setLocalInterface(_objectSpread(_objectSpread({},localInterface),{},{sort:{field:'name',direction:value}}));},onFilterFire:function onFilterFire(){return $setUpdater(Math.random());}}),/*#__PURE__*/_jsx(ReportTableField,{contents:/*#__PURE__*/_jsx(\"span\",{children:\"Main phone\"}),sortDirection:localInterface.sort.field==='phone'?localInterface.sort.direction:undefined,onSortDirectionChange:function onSortDirectionChange(value){return setLocalInterface(_objectSpread(_objectSpread({},localInterface),{},{sort:{field:'phone',direction:value}}));},onFilterFire:function onFilterFire(){return $setUpdater(Math.random());}}),/*#__PURE__*/_jsx(ReportTableField,{contents:/*#__PURE__*/_jsx(\"span\",{children:\"Source\"}),allFiltersSelected:isAllFiltersSelected(\"source\"),onAllFiltersChange:function onAllFiltersChange(value){return switchFilter(\"source\",\"All\",value);},filterWords:reportData.interface.filter_words.source.map(function(filterWord){return{word:filterWord,selected:isFilterSelected(\"source\",filterWord)};}),onFilterChange:function onFilterChange(value){return switchFilter(\"source\",value.word,value.selected);},sortDirection:localInterface.sort.field==='source'?localInterface.sort.direction:undefined,onSortDirectionChange:function onSortDirectionChange(value){return setLocalInterface(_objectSpread(_objectSpread({},localInterface),{},{sort:{field:'source',direction:value}}));},onFilterFire:function onFilterFire(){return $setUpdater(Math.random());}}),/*#__PURE__*/_jsx(ReportTableField,{contents:/*#__PURE__*/_jsx(\"span\",{children:\"Jobs\"}),sortDirection:localInterface.sort.field==='jobs'?localInterface.sort.direction:undefined,onSortDirectionChange:function onSortDirectionChange(value){return setLocalInterface(_objectSpread(_objectSpread({},localInterface),{},{sort:{field:'jobs',direction:value}}));},onFilterFire:function onFilterFire(){return $setUpdater(Math.random());}}),/*#__PURE__*/_jsx(ReportTableField,{contents:/*#__PURE__*/_jsx(\"span\",{children:\"Appointments\"}),sortDirection:localInterface.sort.field==='appointments'?localInterface.sort.direction:undefined,onSortDirectionChange:function onSortDirectionChange(value){return setLocalInterface(_objectSpread(_objectSpread({},localInterface),{},{sort:{field:'appointments',direction:value}}));},onFilterFire:function onFilterFire(){return $setUpdater(Math.random());}}),/*#__PURE__*/_jsx(ReportTableField,{contents:/*#__PURE__*/_jsx(\"span\",{children:\"Recalls\"}),sortDirection:localInterface.sort.field==='recalls'?localInterface.sort.direction:undefined,onSortDirectionChange:function onSortDirectionChange(value){return setLocalInterface(_objectSpread(_objectSpread({},localInterface),{},{sort:{field:'recalls',direction:value}}));},onFilterFire:function onFilterFire(){return $setUpdater(Math.random());}}),/*#__PURE__*/_jsx(ReportTableField,{contents:/*#__PURE__*/_jsx(\"span\",{children:\"Total\"}),sortDirection:localInterface.sort.field==='total'?localInterface.sort.direction:undefined,onSortDirectionChange:function onSortDirectionChange(value){return setLocalInterface(_objectSpread(_objectSpread({},localInterface),{},{sort:{field:'total',direction:value}}));},onFilterFire:function onFilterFire(){return $setUpdater(Math.random());}}),/*#__PURE__*/_jsx(ReportTableField,{contents:/*#__PURE__*/_jsx(\"span\",{children:\"Paid\"}),sortDirection:localInterface.sort.field==='paid'?localInterface.sort.direction:undefined,onSortDirectionChange:function onSortDirectionChange(value){return setLocalInterface(_objectSpread(_objectSpread({},localInterface),{},{sort:{field:'paid',direction:value}}));},onFilterFire:function onFilterFire(){return $setUpdater(Math.random());}}),/*#__PURE__*/_jsx(ReportTableField,{contents:/*#__PURE__*/_jsx(\"span\",{children:\"Unpaid\"}),sortDirection:localInterface.sort.field==='unpaid'?localInterface.sort.direction:undefined,onSortDirectionChange:function onSortDirectionChange(value){return setLocalInterface(_objectSpread(_objectSpread({},localInterface),{},{sort:{field:'unpaid',direction:value}}));},onFilterFire:function onFilterFire(){return $setUpdater(Math.random());}})]}),reportData.clients.map(function(client,i){return/*#__PURE__*/_jsxs(\"tr\",{onClick:function onClick(){return $router.router.navigate('clients.item',{clientId:client.client_id},{reload:true});},children:[/*#__PURE__*/_jsx(\"td\",{children:client.name}),/*#__PURE__*/_jsx(\"td\",{children:client.main_phone}),/*#__PURE__*/_jsx(\"td\",{children:client.source}),/*#__PURE__*/_jsx(\"td\",{children:client.jobs}),/*#__PURE__*/_jsx(\"td\",{children:client.appointments}),/*#__PURE__*/_jsx(\"td\",{children:client.recalls}),/*#__PURE__*/_jsx(\"td\",{children:client.total}),/*#__PURE__*/_jsx(\"td\",{children:client.paid}),/*#__PURE__*/_jsx(\"td\",{children:client.unpaid})]},i);})]}),/*#__PURE__*/_jsxs(\"table\",{className:classNames('table','__hide-on-wide','__hide-on-mobile',{__respectAsidePanel:props.store.navActive.is}),children:[/*#__PURE__*/_jsx(\"tr\",{}),reportData.clients.map(function(client,i){return/*#__PURE__*/_jsxs(\"tr\",{onClick:function onClick(){return $router.router.navigate('clients.item',{clientId:client.client_id},{reload:true});},children:[/*#__PURE__*/_jsxs(\"td\",{children:[/*#__PURE__*/_jsx(\"div\",{children:client.name}),/*#__PURE__*/_jsx(\"div\",{children:client.main_phone})]}),/*#__PURE__*/_jsxs(\"td\",{children:[/*#__PURE__*/_jsx(\"div\",{children:client.source}),/*#__PURE__*/_jsxs(\"div\",{children:[\"Jobs: \",client.jobs]})]}),/*#__PURE__*/_jsxs(\"td\",{children:[/*#__PURE__*/_jsxs(\"div\",{children:[\"Appointments: \",client.appointments]}),/*#__PURE__*/_jsxs(\"div\",{children:[\"Recalls: \",client.recalls]})]}),/*#__PURE__*/_jsxs(\"td\",{children:[/*#__PURE__*/_jsxs(\"div\",{children:[\"Total: \",client.total]}),/*#__PURE__*/_jsxs(\"div\",{children:[\"Paid: \",client.paid]})]}),/*#__PURE__*/_jsxs(\"td\",{children:[/*#__PURE__*/_jsxs(\"div\",{children:[\"Unpaid: \",client.unpaid]}),/*#__PURE__*/_jsx(\"div\",{children:\"\\xA0\"})]})]},i);})]}),/*#__PURE__*/_jsx(\"div\",{className:classNames('mobile-table-items','__show-on-mobile',{__respectAsidePanel:props.store.navActive.is}),children:reportData.clients.map(function(client,i){return/*#__PURE__*/_jsxs(\"div\",{className:\"item\",onClick:function onClick(){return $router.router.navigate('clients.item',{clientId:client.client_id},{reload:true});},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"__top\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"__left\",children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"b\",{children:client.name})}),/*#__PURE__*/_jsx(\"div\",{children:client.main_phone})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"__right\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[\"Total: \",/*#__PURE__*/_jsx(\"b\",{children:client.total})]}),/*#__PURE__*/_jsxs(\"div\",{children:[\"Paid: \",/*#__PURE__*/_jsx(\"b\",{children:client.paid})]}),/*#__PURE__*/_jsxs(\"div\",{children:[\"Unpaid: \",/*#__PURE__*/_jsx(\"b\",{children:client.unpaid})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"__bottom\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"__left\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"gray\",children:\"Jobs:\"}),/*#__PURE__*/_jsxs(\"span\",{children:[\" \",client.jobs]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"gray\",children:\"Recalls:\"}),/*#__PURE__*/_jsxs(\"span\",{children:[\" \",client.recalls]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"gray\",children:\"Appointments:\"}),/*#__PURE__*/_jsxs(\"span\",{children:[\" \",client.appointments]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"__right small\",children:/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"b\",{children:client.source})})})]})]},i);})})]}),/*#__PURE__*/_jsx(ReportTableControls,{isUnder:true,onMaxRowsChange:function onMaxRowsChange(){return $setUpdater(Math.random());},amount:{total:reportData.interface.rows_all,start:reportData.interface.rows_start,end:reportData.interface.rows_end},page:localInterface.page,maxPages:reportData.interface.max_pages,onPagesStart:function onPagesStart(){return setLocalInterface(_objectSpread(_objectSpread({},localInterface),{},{page:1}));},onPrevPage:function onPrevPage(){return setLocalInterface(_objectSpread(_objectSpread({},localInterface),{},{page:localInterface.page-1}));},onNextPage:function onNextPage(){return setLocalInterface(_objectSpread(_objectSpread({},localInterface),{},{page:localInterface.page+1}));},onPagesEnd:function onPagesEnd(){return setLocalInterface(_objectSpread(_objectSpread({},localInterface),{},{page:reportData.interface.max_pages}));},sort:localInterface.sort,sortFields:localInterface.sortFields,onSortFieldChange:function onSortFieldChange(value){return setLocalInterface(_objectSpread(_objectSpread({},localInterface),{},{sort:_objectSpread(_objectSpread({},localInterface.sort),{},{field:value})}));},onSortDirectionChange:function onSortDirectionChange(value){return setLocalInterface(_objectSpread(_objectSpread({},localInterface),{},{sort:_objectSpread(_objectSpread({},localInterface.sort),{},{direction:value})}));},onSortFire:function onSortFire(){return 0;}})]}):null});});export default ClientsPage_List;","map":{"version":3,"sources":["/Users/nicole/rrrr/crm/src/pages/Clients/List.tsx"],"names":["classNames","useEffect","useState","connect","useRoute","Icon","ReportFilters","ReportTableControls","ReportTableField","getActiveAccount","httpClient","nError","mapDispatchToProps","mapStateToProps","qs","ClientsPage_List","props","$router","activeAccount","store","Math","random","$updater","$setUpdater","reportData","setReportData","search","page","max_rows","filter_words","source","sort","field","direction","sortFields","span","value","localInterface","setLocalInterface","loadClients","activeFilters","Object","keys","forEach","key","length","reqData","account_id","limit_rows","reportsMaxRows","sort_field","sort_type","filter_field","JSON","stringify","post","clients","data","console","log","isFilterSelected","includes","isAllFiltersSelected","switchFilter","toggle","_arr","i","findIndex","filter","splice","interface","every","option","concat","push","dashboard","all","unpaid","new_this_month","new_last_month","total","rows_all","start","rows_start","end","rows_end","max_pages","router","navigate","reload","__respectAsidePanel","navActive","is","undefined","map","filterWord","word","selected","client","clientId","client_id","name","main_phone","jobs","appointments","recalls","paid"],"mappings":"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","sourcesContent":["import axios from \"axios\"\nimport classNames from \"classnames\"\nimport { useEffect, useState } from \"react\";\nimport { connect } from \"react-redux\";\nimport { useRoute } from \"react-router5\"\nimport Icon from \"../../components/Icon\"\nimport ReportFilters from \"../../components/reports/Filters\"\nimport ReportTableControls from \"../../components/reports/TableControls\"\nimport ReportTableField from \"../../components/reports/TableField\"\nimport {getActiveAccount, httpClient, nError} from \"../../funcs\"\nimport Client from \"../../models/Client\"\nimport { StoreDispatch, StoreState, mapDispatchToProps, mapStateToProps } from \"../../store\";\n\nimport \"../../styles/pages/common/report-list.sass\"\nimport storage from \"redux-persist/lib/storage\";\nimport qs from \"qs\";\nimport Account from \"../../models/Account\";\n\ninterface Props {\n  store: StoreState,\n  dispatcher: StoreDispatch\n}\n\ntype FilterWord = 'source'\n\ninterface ClientsReport {\n\n  interface: {\n\n    filter_words: {\n\n      source: string[],\n    },\n\n    max_pages: number,\n    rows_start: number,\n    rows_end: number,\n    rows_all: number,\n  },\n\n  permissions: {\n    show_client: boolean,\n  },\n\n  dashboard: {\n\n    all: string,\n    unpaid: string,\n    new_this_month: string,\n    new_last_month: string\n  },\n\n  clients: Client[]\n}\n\nconst ClientsPage_List = connect(mapStateToProps, mapDispatchToProps)(function(props: Props) {\n\n  const $router = useRoute();\n  const activeAccount = getActiveAccount(props.store) as Account\n  const [$updater, $setUpdater] = useState<any>(Math.random())\n\n  const [reportData, setReportData] = useState<ClientsReport | null>(null)\n  const [localInterface, setLocalInterface] = useState({\n\n    search: '',\n\n    page: 1,\n    max_rows: 100 as 50 | 100 | 250 | 500,\n\n    filter_words: {\n\n      source: [] as string[],\n    },\n\n    sort: {\n      field: 'name',\n      direction: 'up' as 'up' | 'down'\n    },\n    sortFields: [{\n      span: 'Name',\n      value: 'name'\n    },\n    {\n      span: 'Date',\n      value: 'created_at'\n    },{\n      span: 'Main Phone',\n      value: 'phone'\n    },{\n      span: 'Source',\n      value: 'source'\n    },{\n      span: 'Jobs',\n      value: 'jobs'\n    },{\n      span: 'Appointments',\n      value: 'appointments'\n    },{\n      span: 'Recalls',\n      value: 'recalls'\n    },{\n      span: 'Total',\n      value: 'total'\n    },{\n      span: 'Paid',\n      value: 'paid'\n    },{\n      span: 'Unpaid',\n      value: 'unpaid'\n    }]\n\n  })\n\n  // Load clients function\n  async function loadClients() {\n    let activeFilters: any = {...localInterface.filter_words}\n    Object.keys(localInterface.filter_words).forEach((key: any) => !activeFilters[key].length && delete activeFilters[key])\n    let reqData = {\n      account_id:activeAccount.account_id,\n      limit_rows: props.store.reportsMaxRows,\n      page: localInterface.page,\n      sort_field: localInterface.sort.field,\n      sort_type: localInterface.sort.direction === 'up' ? 'asc' : 'desc',\n      filter_field: JSON.stringify(activeFilters),\n      ...(localInterface.search ? {search: localInterface.search} : {})\n    };\n    try {\n      const { data: clients } = (await httpClient.post('/clients/report',qs.stringify(reqData))) as {data: ClientsReport}\n      console.log(clients)\n      setReportData(clients)\n\n\n    }\n    catch (error) {\n\n      nError(error)\n    }\n  }\n\n  // Load clients on page mount\n\n  useEffect(() => { loadClients()}, [\n    $updater,\n    localInterface.page\n  ])\n  // Is filter selected function\n  function isFilterSelected(field: FilterWord, value: string) {\n    return localInterface.filter_words[field].includes(value)\n  }\n\n  function isAllFiltersSelected(field: \"source\") {\n    return localInterface.filter_words[field].length === 0\n  }\n\n  function switchFilter(field: FilterWord, value: string, toggle: boolean) {\n\n    let _arr = [...localInterface.filter_words[field]]\n\n    if (toggle && value === \"All\") { _arr = [] }\n    \n    else if (!toggle) {\n\n      while (true) {\n        let i = _arr.findIndex((filter) => filter === value)\n        if(i === -1) break\n        _arr.splice(i, 1)\n      }\n    }\n      \n    else {\n\n      if (reportData?.interface.filter_words[field].every((option) => _arr.concat([value]).includes(option)))\n        _arr = []\n\n      else if(_arr.findIndex((filter) => filter === value) === -1)\n        _arr.push(value)\n    }\n\n    setLocalInterface({...localInterface, filter_words: {...localInterface.filter_words, [field]: _arr}})\n  }\n\n  // Render function\n  return (<>\n    {reportData ? (\n      <div className=\"ClientsPage_List\" >\n      \n        { /* Reports grid */}\n        <div className=\"reports-grid\">\n        \n          <div className=\"cell\">\n\n            <div className=\"amount\">{reportData.dashboard.all}</div>\n            <div className=\"legend\">All Clients</div>\n          </div>\n\n          <div className=\"cell\">\n\n            <div className=\"amount\">{reportData.dashboard.unpaid}</div>\n            <div className=\"legend\">Unpaid</div>\n          </div>\n\n          <div className=\"cell\">\n\n            <div className=\"amount\">{reportData.dashboard.new_this_month}</div>\n            <div className=\"legend\">New This Month</div>\n          </div>\n\n          <div className=\"cell\">\n\n            <div className=\"amount\">{reportData.dashboard.new_last_month}</div>\n            <div className=\"legend\">New Last Month</div>\n          </div>\n        </div>\n\n        { /* Page header */}\n        <div className=\"page-header\">\n          <h1>Clients</h1>\n        </div>\n\n        { /* List filters */}\n        <ReportFilters\n          onSearchInputChange={(value) => setLocalInterface({...localInterface, search: value})}\n\n          onUpdate={() => {\n            $setUpdater(Math.random());\n          }}\n        />\n\n        {/* Table controls */}\n        <ReportTableControls\n          zIndex={5}\n          \n          onMaxRowsChange={() => {\n            $setUpdater(Math.random());\n          }}\n\n          amount={{\n            total: reportData.interface.rows_all,\n            start: reportData.interface.rows_start,\n            end: reportData.interface.rows_end\n          }}\n\n          page={localInterface.page}\n          maxPages={reportData.interface.max_pages}\n          onPagesStart={() => setLocalInterface({...localInterface, page: 1})}\n          onPrevPage={() => setLocalInterface({...localInterface, page: localInterface.page-1})}\n          onNextPage={() => setLocalInterface({...localInterface, page: localInterface.page+1})}\n          onPagesEnd={() => setLocalInterface({...localInterface, page: reportData.interface.max_pages})}\n          \n          sort={localInterface.sort}\n          sortFields={localInterface.sortFields}\n          onSortFieldChange={(value) => setLocalInterface({...localInterface, sort: {...localInterface.sort, field: value}})}\n          onSortDirectionChange={(value) => setLocalInterface({...localInterface, sort: {...localInterface.sort, direction: value}})}\n          onSortFire={() => 0}\n\n          addButton={(\n            <div className=\"add-button-wrapper\">\n              <button className=\"_iconed _rounded add-button\" onClick={() => $router.router.navigate('clients.new', {}, {reload: true})}>\n                <Icon icon=\"plus-thin\" />\n                <span>Add Client</span>\n                <Icon icon=\"user-29\" />\n              </button>\n            </div>\n          )}\n        />\n\n        <div className=\"contents\">\n\n          {/* Wide desktop table */}\n          <table className={classNames('table', '__show-on-wide', {\n            __respectAsidePanel: props.store.navActive.is\n          })}>\n            <tr>\n              <ReportTableField\n                contents={(<span>Name</span>)}\n\n                sortDirection={localInterface.sort.field === 'name' ? localInterface.sort.direction : undefined}\n                onSortDirectionChange={(value) => setLocalInterface({...localInterface, sort: {field: 'name', direction: value}})}\n\n                onFilterFire={() => $setUpdater(Math.random())}\n              />\n              <ReportTableField\n                contents={(<span>Main phone</span>)}\n\n                sortDirection={localInterface.sort.field === 'phone' ? localInterface.sort.direction : undefined}\n                onSortDirectionChange={(value) => setLocalInterface({...localInterface, sort: {field: 'phone', direction: value}})}\n\n                onFilterFire={() => $setUpdater(Math.random())}\n              />\n              <ReportTableField\n                contents={(<span>Source</span>)}\n\n                allFiltersSelected={isAllFiltersSelected(\"source\")}\n                onAllFiltersChange={(value) => switchFilter(\"source\", \"All\", value)}\n\n                filterWords={reportData.interface.filter_words.source.map((filterWord) => ({\n                  word: filterWord,\n                  selected: isFilterSelected(\"source\", filterWord)\n                }))}\n                onFilterChange={(value) => switchFilter(\"source\", value.word, value.selected)}\n\n                sortDirection={localInterface.sort.field === 'source' ? localInterface.sort.direction : undefined}\n                onSortDirectionChange={(value) => setLocalInterface({...localInterface, sort: {field: 'source', direction: value}})}\n\n                onFilterFire={() => $setUpdater(Math.random())}\n              />\n              <ReportTableField\n                contents={(<span>Jobs</span>)}\n\n                sortDirection={localInterface.sort.field === 'jobs' ? localInterface.sort.direction : undefined}\n                onSortDirectionChange={(value) => setLocalInterface({...localInterface, sort: {field: 'jobs', direction: value}})}\n\n                onFilterFire={() => $setUpdater(Math.random())}\n              />\n              <ReportTableField\n                contents={(<span>Appointments</span>)}\n\n                sortDirection={localInterface.sort.field === 'appointments' ? localInterface.sort.direction : undefined}\n                onSortDirectionChange={(value) => setLocalInterface({...localInterface, sort: {field: 'appointments', direction: value}})}\n\n                onFilterFire={() => $setUpdater(Math.random())}\n              />\n              <ReportTableField\n                contents={(<span>Recalls</span>)}\n\n                sortDirection={localInterface.sort.field === 'recalls' ? localInterface.sort.direction : undefined}\n                onSortDirectionChange={(value) => setLocalInterface({...localInterface, sort: {field: 'recalls', direction: value}})}\n\n                onFilterFire={() => $setUpdater(Math.random())}\n              />\n              <ReportTableField\n                contents={(<span>Total</span>)}\n\n                sortDirection={localInterface.sort.field === 'total' ? localInterface.sort.direction : undefined}\n                onSortDirectionChange={(value) => setLocalInterface({...localInterface, sort: {field: 'total', direction: value}})}\n\n                onFilterFire={() => $setUpdater(Math.random())}\n              />\n              <ReportTableField\n                contents={(<span>Paid</span>)}\n\n                sortDirection={localInterface.sort.field === 'paid' ? localInterface.sort.direction : undefined}\n                onSortDirectionChange={(value) => setLocalInterface({...localInterface, sort: {field: 'paid', direction: value}})}\n\n                onFilterFire={() => $setUpdater(Math.random())}\n              />\n              <ReportTableField\n                contents={(<span>Unpaid</span>)}\n\n                sortDirection={localInterface.sort.field === 'unpaid' ? localInterface.sort.direction : undefined}\n                onSortDirectionChange={(value) => setLocalInterface({...localInterface, sort: {field: 'unpaid', direction: value}})}\n\n                onFilterFire={() => $setUpdater(Math.random())}\n              />\n            </tr>\n            {reportData.clients.map((client, i) => (\n              <tr key={i} onClick={() => $router.router.navigate('clients.item', {\n                clientId: client.client_id\n              }, {reload: true})}>\n                <td>{client.name}</td>\n                <td>{client.main_phone}</td>\n                <td>{client.source}</td>\n                <td>{client.jobs}</td>\n                <td>{client.appointments}</td>\n                <td>{client.recalls}</td>\n                <td>{client.total}</td>\n                <td>{client.paid}</td>\n                <td>{client.unpaid}</td>\n              </tr>\n            ))}\n          </table>\n\n          {/* Medium screen table */}\n          <table className={classNames('table', '__hide-on-wide', '__hide-on-mobile', {\n            __respectAsidePanel: props.store.navActive.is\n          })}>\n            <tr></tr>\n            {reportData.clients.map((client, i) => (\n              <tr key={i} onClick={() => $router.router.navigate('clients.item', {\n                clientId: client.client_id\n              }, {reload: true})}>\n                <td>\n                  <div>{client.name}</div>\n                  <div>{client.main_phone}</div>\n                </td>\n                <td>\n                  <div>{client.source}</div>\n                  <div>Jobs: {client.jobs}</div>\n                </td>\n                <td>\n                  <div>Appointments: {client.appointments}</div>\n                  <div>Recalls: {client.recalls}</div>\n                </td>\n                <td>\n                  <div>Total: {client.total}</div>\n                  <div>Paid: {client.paid}</div>\n                </td>\n                <td>\n                  <div>Unpaid: {client.unpaid}</div>\n                  <div>&nbsp;</div>\n                </td>\n              </tr>\n            ))}\n          </table>\n\n          {/* Mobile table items */}\n          <div className={classNames('mobile-table-items', '__show-on-mobile', {\n            __respectAsidePanel: props.store.navActive.is\n          })}>\n\n            {reportData.clients.map((client, i: number) => (\n              <div className=\"item\" key={i} onClick={() => $router.router.navigate('clients.item', {\n                clientId: client.client_id\n              }, {reload: true})}>\n\n                <div className=\"__top\">\n\n                  <div className=\"__left\">\n                    <div><b>{client.name}</b></div>\n                    <div>\n                      {client.main_phone}\n                    </div>\n                  </div>\n\n                  <div className=\"__right\">\n                    <div>\n                      Total: <b>{client.total}</b>\n                    </div>\n                    <div>\n                      Paid: <b>{client.paid}</b>\n                    </div>\n                    <div>\n                      Unpaid: <b>{client.unpaid}</b>\n                    </div>\n                  </div>\n                </div>\n\n                <div className=\"__bottom\">\n\n                  <div className=\"__left\">\n                    <div>\n                      <span className=\"gray\">Jobs:</span>\n                      <span> {client.jobs}</span>\n                    </div>\n                    <div>\n                      <span className=\"gray\">Recalls:</span>\n                      <span> {client.recalls}</span>\n                    </div>\n                    <div>\n                      <span className=\"gray\">Appointments:</span>\n                      <span> {client.appointments}</span>\n                    </div>\n                  </div>\n\n                  <div className=\"__right small\">\n                    <div>\n                      <b>{client.source}</b>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n\n        {/* Table controls */}\n        <ReportTableControls\n          isUnder={true}\n\n          onMaxRowsChange={() => $setUpdater(Math.random())}\n\n          amount={{\n            total: reportData.interface.rows_all,\n            start: reportData.interface.rows_start,\n            end: reportData.interface.rows_end\n          }}\n\n          page={localInterface.page}\n          maxPages={reportData.interface.max_pages}\n          onPagesStart={() => setLocalInterface({...localInterface, page: 1})}\n          onPrevPage={() => setLocalInterface({...localInterface, page: localInterface.page-1})}\n          onNextPage={() => setLocalInterface({...localInterface, page: localInterface.page+1})}\n          onPagesEnd={() => setLocalInterface({...localInterface, page: reportData.interface.max_pages})}\n          \n          sort={localInterface.sort}\n          sortFields={localInterface.sortFields}\n          onSortFieldChange={(value) => setLocalInterface({...localInterface, sort: {...localInterface.sort, field: value}})}\n          onSortDirectionChange={(value) => setLocalInterface({...localInterface, sort: {...localInterface.sort, direction: value}})}\n          onSortFire={() => 0}\n        />\n      </div>\n    ) : null}\n  </>)\n})\nexport default ClientsPage_List\n"]},"metadata":{},"sourceType":"module"}