{"ast":null,"code":"import _toConsumableArray from\"/Users/nicole/rrrr/crm/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _objectSpread from\"/Users/nicole/rrrr/crm/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/Users/nicole/rrrr/crm/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/nicole/rrrr/crm/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/nicole/rrrr/crm/node_modules/@babel/runtime/regenerator/index.js\";import axios from\"axios\";import React,{useEffect,useState}from\"react\";import{connect}from\"react-redux\";import Icon from\"../../components/Icon\";import{nError}from\"../../funcs\";import{mapDispatchToProps,mapStateToProps}from\"../../store\";import\"../../styles/pages/common/entity-edit.sass\";import Select from\"../../components/Select\";import Checkbox from\"../../components/Checkbox\";import{useRoute}from\"react-router5\";import classNames from\"classnames\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var PermissionsPage_Item=connect(mapStateToProps,mapDispatchToProps)(function(props){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),readyToSave=_useState2[0],setReadyToSave=_useState2[1];var $router=useRoute();var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),deleting=_useState4[0],setDeleting=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),readyToDelete=_useState6[0],setReadyToDelete=_useState6[1];var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),permissionData=_useState8[0],setPermissionData=_useState8[1];var _useState9=useState(''),_useState10=_slicedToArray(_useState9,2),selectedAction=_useState10[0],setSelectedAction=_useState10[1];var _useState11=useState({name:'',users:'',actions:[]}),_useState12=_slicedToArray(_useState11,2),newPermissionData=_useState12[0],setNewPermissionData=_useState12[1];var _useState13=useState([]),_useState14=_slicedToArray(_useState13,2),availableActions=_useState14[0],setAvailableActions=_useState14[1];// Load info function\nfunction loadInfo(){return _loadInfo.apply(this,arguments);}// Load permission data\nfunction _loadInfo(){_loadInfo=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _ref2,_permissionData,_availableActions;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return axios.get('/json/permission.json');case 3:_ref2=_context.sent;_permissionData=_ref2.data;_availableActions=[''].concat(_permissionData.edit.actions.filter(function(action){return!_permissionData.permission.actions.includes(action);}));setPermissionData(_permissionData);setAvailableActions(_availableActions);setSelectedAction(_availableActions[0]);setNewPermissionData(_objectSpread(_objectSpread({},newPermissionData),{},{actions:_permissionData.permission.actions}));setTimeout(function(){return setReadyToSave(false);},100);_context.next=16;break;case 13:_context.prev=13;_context.t0=_context[\"catch\"](0);nError(_context.t0);case 16:case\"end\":return _context.stop();}}},_callee,null,[[0,13]]);}));return _loadInfo.apply(this,arguments);}useEffect(function(){loadInfo();},[]);// Add action function\nfunction addAction(){if(!newPermissionData.actions||!permissionData||!newPermissionData)return;setNewPermissionData(_objectSpread(_objectSpread({},newPermissionData),{},{actions:[].concat(_toConsumableArray(newPermissionData.actions),[selectedAction])}));var _availableActions=_toConsumableArray(permissionData===null||permissionData===void 0?void 0:permissionData.edit.actions);_availableActions=permissionData.edit.actions.filter(function(action){return!newPermissionData.actions.includes(action);});_availableActions.splice(_availableActions.findIndex(function(_action){return selectedAction===_action;}),1);setAvailableActions(_toConsumableArray(_availableActions));setSelectedAction('');setReadyToSave(true);}// Remove action function\nfunction removeAction(i){var _permissionActions=_toConsumableArray(newPermissionData.actions);var _action=_permissionActions[i];_permissionActions.splice(i,1);setNewPermissionData(_objectSpread(_objectSpread({},newPermissionData),{},{actions:_permissionActions}));setAvailableActions([].concat(_toConsumableArray(availableActions),[_action]));setReadyToSave(true);}useEffect(function(){return setReadyToSave(true);},[newPermissionData]);// Render function\nreturn/*#__PURE__*/_jsx(_Fragment,{children:permissionData&&newPermissionData?/*#__PURE__*/_jsxs(\"div\",{className:\"PermissionsPage_Item entity-edit\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"wrapper flex-container sb\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex-container _gap-narrow\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Permission:\"}),/*#__PURE__*/_jsx(\"div\",{className:\"item-name\",children:permissionData.permission.name})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"fieldset\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"legend\",children:\"Main\"}),/*#__PURE__*/_jsx(\"div\",{className:\"fields\",children:/*#__PURE__*/_jsx(\"div\",{className:\"__left\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"field\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Name:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",defaultValue:permissionData.permission.name,onChange:function onChange(_ref){var value=_ref.target.value;return setNewPermissionData(_objectSpread(_objectSpread({},newPermissionData),{},{name:value}));}})]})})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"fieldset\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex-container sb wrap\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"legend\",children:\"Actions\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"legend-action-wrapper\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Action:\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"input-wrapper\",children:[/*#__PURE__*/_jsx(Select,{options:availableActions.map(function(action){return{span:action,value:action};}),selectedOption:selectedAction,onChange:function onChange(value){return setSelectedAction(value);}}),/*#__PURE__*/_jsx(\"button\",{disabled:!selectedAction,className:\"_green\",onClick:function onClick(){return addAction();},children:\"Add\"})]})]})]}),/*#__PURE__*/_jsxs(\"table\",{className:\"table som\",children:[/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{style:{width:'100%'},children:\"Action\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Allow\"}),/*#__PURE__*/_jsx(\"th\",{})]}),newPermissionData.actions.map(function(action,i){return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:action}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(Checkbox,{contents:'',value:true})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"button\",{className:\"_zeroed _iconed _red\",onClick:function onClick(){return removeAction(i);},children:/*#__PURE__*/_jsx(Icon,{icon:\"x-mark-1\"})})})]},i);})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"fieldset\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"legend\",children:\"Info\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"fields\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"__left\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"field\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Date Created:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",defaultValue:'',disabled:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"field\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Created by:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",defaultValue:'',disabled:true})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"__right\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"field\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Last Edited:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",defaultValue:'',disabled:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"field\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Last Edited By:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",defaultValue:'',disabled:true})]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"fieldset\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"legend\",children:\"Users\"}),/*#__PURE__*/_jsxs(\"table\",{className:\"table\",children:[/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"First Name\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Last Name\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Function\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Active\"})]}),permissionData.users.map(function(user,i){return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:user.firstname}),/*#__PURE__*/_jsx(\"td\",{children:user.lastname}),/*#__PURE__*/_jsx(\"td\",{children:user.function}),/*#__PURE__*/_jsx(\"td\",{className:classNames({'red-text':user.active==='Inactive','green-text':user.active==='Active','blue-text':!['Inactive','Active'].includes(user.active)}),children:user.active})]},i);})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"wrapper flex-container sb editing-buttons\",children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"button\",{className:\"_red\",onClick:function onClick(){return setDeleting(true);},children:\"Delete Permission\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"buttons\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"_bordered _red\",onClick:function onClick(){return $router.router.navigate('permissions',{},{reload:true});},children:\"Cancel\"}),/*#__PURE__*/_jsx(\"button\",{disabled:!readyToSave,className:\"_bordered _green\",children:\"Save\"})]})]}),deleting?/*#__PURE__*/_jsx(\"div\",{className:\"item-delete-popup\",onClick:function onClick(){return setDeleting(false);},children:/*#__PURE__*/_jsxs(\"div\",{className:\"wrapper\",onClick:function onClick(e){return e.stopPropagation();},children:[/*#__PURE__*/_jsx(\"div\",{className:\"title\",children:\"Delete Permission\"}),/*#__PURE__*/_jsx(\"div\",{className:\"checkbox-wrapper\",children:/*#__PURE__*/_jsx(Checkbox,{contents:\"I understand that after deleting the permission it will not be possible to recover.\",value:readyToDelete,onChange:function onChange(value){return setReadyToDelete(value);}})}),/*#__PURE__*/_jsxs(\"div\",{className:\"buttons\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"_bordered _green\",onClick:function onClick(){return setDeleting(false);},children:\"Cancel\"}),/*#__PURE__*/_jsx(\"button\",{disabled:!readyToDelete,className:\"_bordered _red\",children:\"Delete\"})]})]})}):null]}):null});});export default PermissionsPage_Item;","map":{"version":3,"sources":["/Users/nicole/rrrr/crm/src/pages/Permissions/Item.tsx"],"names":["axios","React","useEffect","useState","connect","Icon","nError","mapDispatchToProps","mapStateToProps","Select","Checkbox","useRoute","classNames","PermissionsPage_Item","props","readyToSave","setReadyToSave","$router","deleting","setDeleting","readyToDelete","setReadyToDelete","permissionData","setPermissionData","selectedAction","setSelectedAction","name","users","actions","newPermissionData","setNewPermissionData","availableActions","setAvailableActions","loadInfo","get","data","_availableActions","concat","edit","filter","action","permission","includes","setTimeout","addAction","splice","findIndex","_action","removeAction","i","_permissionActions","value","target","map","span","width","user","firstname","lastname","function","active","router","navigate","reload","e","stopPropagation"],"mappings":"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","sourcesContent":["import axios from \"axios\"\nimport React, { useEffect, useState } from \"react\";\nimport { connect } from \"react-redux\";\nimport Icon from \"../../components/Icon\"\nimport { nError } from \"../../funcs\"\nimport Permission from \"../../models/Permission\"\nimport { StoreDispatch, StoreState, mapDispatchToProps, mapStateToProps } from \"../../store\";\nimport Datetime from 'react-datetime'\n\nimport \"../../styles/pages/common/entity-edit.sass\"\nimport moment from \"moment\"\nimport Select from \"../../components/Select\"\nimport Checkbox from \"../../components/Checkbox\"\nimport { useRoute } from \"react-router5\"\nimport PermissionUser from \"../../models/PermissionUser\"\nimport classNames from \"classnames\"\n\ninterface Props {\n  store: StoreState,\n  dispatcher: StoreDispatch\n}\n\ninterface PermissionData {\n\tpermissions: {\n\t\tedit_permission: boolean,\n\t\tshow_user: boolean\n\t},\n\tpermission: Permission,\n\tusers: PermissionUser[],\n\tedit: {\n\t\tactions: string[]\n\t}\n}\n\nconst PermissionsPage_Item = connect(mapStateToProps, mapDispatchToProps)(function(props: Props) {\n\n  const [readyToSave, setReadyToSave] = useState(false)\n\n  const $router = useRoute()\n\n  const [deleting, setDeleting] = useState(false)\n  const [readyToDelete, setReadyToDelete] = useState(false)\n  \n  const [permissionData, setPermissionData] = useState<PermissionData | null>(null)\n\n  const [selectedAction, setSelectedAction] = useState<string>('')\n\n  const [newPermissionData, setNewPermissionData] = useState<Partial<Permission>>({\n    name: '',\n    users: '',\n    actions: [] as string[]\n  })\n\n  const [availableActions, setAvailableActions] = useState<string[]>([])\n\n  // Load info function\n  async function loadInfo() {\n    try {\n      const { data: permissionData } = (await axios.get('/json/permission.json')) as {data: PermissionData}\n\n      let _availableActions = [''].concat(permissionData.edit.actions.filter((action) => !permissionData.permission.actions.includes(action)))\n\n      setPermissionData(permissionData)\n      setAvailableActions(_availableActions)\n      setSelectedAction(_availableActions[0])\n      setNewPermissionData({\n        ...newPermissionData,\n        actions: permissionData.permission.actions\n      })\n\n      setTimeout(() => setReadyToSave(false), 100)\n    }\n    catch (error) {\n      nError(error)\n    }\n  }\n\n  // Load permission data\n  useEffect(() => {\n    loadInfo()\n  }, [])\n\n  // Add action function\n  function addAction() {\n\n    if(!newPermissionData.actions || !permissionData || !newPermissionData) return\n\n    setNewPermissionData({\n      ...newPermissionData,\n      actions: [\n        ...newPermissionData.actions,\n        selectedAction\n      ]\n    })\n\n    let _availableActions = [...permissionData?.edit.actions]\n\n    _availableActions = permissionData.edit.actions.filter((action) => !(newPermissionData.actions as string[]).includes(action))\n    _availableActions.splice(_availableActions.findIndex((_action) => selectedAction === _action), 1)\n\n    setAvailableActions([\n      ..._availableActions\n    ])\n\n    setSelectedAction('')\n\n    setReadyToSave(true)\n  }\n\n  // Remove action function\n  function removeAction(i: number) {\n\n    let _permissionActions = [...(newPermissionData.actions as string[])]\n\n    let _action = _permissionActions[i]\n    \n    _permissionActions.splice(i, 1)\n\n    setNewPermissionData({\n      ...newPermissionData,\n      actions: _permissionActions\n    })\n\n    setAvailableActions([\n      ...availableActions,\n      _action\n    ])\n\n    setReadyToSave(true)\n  }\n\n  useEffect(() => setReadyToSave(true), [\n    newPermissionData\n  ])\n  \n  // Render function\n  return (<>\n    {permissionData && newPermissionData ? (\n      <div className=\"PermissionsPage_Item entity-edit\">\n\n        <div className=\"wrapper flex-container sb\">\n          <div className=\"flex-container _gap-narrow\">\n            <h1>Permission:</h1>\n            <div className=\"item-name\">\n              {permissionData.permission.name}\n            </div>\n          </div>\n        </div>\n        \n        <div className=\"fieldset\">\n          \n          <div className=\"legend\">Main</div>\n\n          <div className=\"fields\">\n\n            <div className=\"__left\">\n              <div className=\"field\">\n                <span>Name:</span>\n                <input type=\"text\" defaultValue={permissionData.permission.name} onChange={({target: {value}}) => setNewPermissionData({...newPermissionData, name: value})} />\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"fieldset\">\n\n          <div className=\"flex-container sb wrap\">\n            <div className=\"legend\">Actions</div>\n\n            <div className=\"legend-action-wrapper\">\n              <label>Action:</label>\n              <div className=\"input-wrapper\">\n                <Select options={availableActions.map((action) => ({\n                  span: action,\n                  value: action\n                }))} selectedOption={selectedAction} onChange={(value) => setSelectedAction(value as string)}/>\n                <button disabled={!selectedAction} className=\"_green\" onClick={() => addAction()}>\n                  Add\n                </button>\n              </div>\n            </div>\n          </div>\n\n          <table className=\"table som\">\n            <tr>\n              <th style={{width: '100%'}}>Action</th>\n              <th>Allow</th>\n              <th></th>\n            </tr>\n            {(newPermissionData.actions as string[]).map((action, i) => (\n              <tr key={i}>\n                <td>{action}</td>\n                <td>\n                  <Checkbox contents={''} value={true} />\n                </td>\n                <td>\n                  <button className=\"_zeroed _iconed _red\" onClick={() => removeAction(i)}>\n                    <Icon icon=\"x-mark-1\" />\n                  </button>\n                </td>\n              </tr>\n            ))}\n          </table>\n        </div>\n\n        <div className=\"fieldset\">\n          \n          <div className=\"legend\">Info</div>\n\n          <div className=\"fields\">\n\n            <div className=\"__left\">\n              <div className=\"field\">\n                <span>Date Created:</span>\n                <input type=\"text\" defaultValue={''} disabled={ true } />\n              </div>\n\n              <div className=\"field\">\n                <span>Created by:</span>\n                <input type=\"text\" defaultValue={''} disabled={ true } />\n              </div>\n            </div>\n\n            \n            <div className=\"__right\">\n\n              <div className=\"field\">\n                <span>Last Edited:</span>\n                <input type=\"text\" defaultValue={''} disabled={ true } />\n              </div>\n\n              <div className=\"field\">\n                <span>Last Edited By:</span>\n                <input type=\"text\" defaultValue={''} disabled={ true } />\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"fieldset\">\n\n          <div className=\"legend\">Users</div>\n\n          <table className=\"table\">\n            <tr>\n              <th>First Name</th>\n              <th>Last Name</th>\n              <th>Function</th>\n              <th>Active</th>\n            </tr>\n            {permissionData.users.map((user, i) => (\n              <tr key={i}>\n                <td>{user.firstname}</td>\n                <td>{user.lastname}</td>\n                <td>{user.function}</td>\n                <td className={classNames({\n                  'red-text': user.active === 'Inactive',\n                  'green-text': user.active === 'Active',\n                  'blue-text': !['Inactive', 'Active'].includes(user.active)\n                })}>{user.active}</td>\n              </tr>\n            ))}\n          </table>\n        </div>\n\n        <div className=\"wrapper flex-container sb editing-buttons\">\n          <div>\n            <button className=\"_red\" onClick={() => setDeleting(true)}>Delete Permission</button>\n          </div>\n          <div className=\"buttons\">\n            <button className=\"_bordered _red\" onClick={() => $router.router.navigate('permissions', {}, {\n              reload: true\n            })}>\n              Cancel\n            </button>\n            <button disabled={!readyToSave} className=\"_bordered _green\">\n              Save\n            </button>\n          </div>\n        </div>\n\n        {/* Item delete popup */}\n        {deleting ? (\n          <div className=\"item-delete-popup\" onClick={() => setDeleting(false)}>\n\n            <div className=\"wrapper\" onClick={(e) => e.stopPropagation()}>\n            \n              <div className=\"title\">\n                Delete Permission\n              </div>\n\n              <div className=\"checkbox-wrapper\">\n                <Checkbox contents=\"I understand that after deleting the permission it will not be possible to recover.\" value={readyToDelete} onChange={(value) => setReadyToDelete(value)} />\n              </div>\n\n              <div className=\"buttons\">\n\n                <button className=\"_bordered _green\" onClick={() => setDeleting(false)}>\n                  Cancel\n                </button>\n\n                <button disabled={!readyToDelete} className=\"_bordered _red\">\n                  Delete\n                </button>\n              </div>\n            </div>\n          </div>\n        ) : null}\n      </div>\n    ) : null}\n  </>)\n})\nexport default PermissionsPage_Item\n"]},"metadata":{},"sourceType":"module"}