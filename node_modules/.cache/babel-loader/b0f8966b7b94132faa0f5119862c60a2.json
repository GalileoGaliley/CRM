{"ast":null,"code":"import _toConsumableArray from\"/Users/nicole/rrrr/crm/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _objectSpread from\"/Users/nicole/rrrr/crm/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/Users/nicole/rrrr/crm/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/nicole/rrrr/crm/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/nicole/rrrr/crm/node_modules/@babel/runtime/regenerator/index.js\";import axios from\"axios\";import React,{useEffect,useState}from\"react\";import{connect}from\"react-redux\";import Icon from\"../../components/Icon\";import{nError}from\"../../funcs\";import{mapDispatchToProps,mapStateToProps}from\"../../store\";import\"../../styles/pages/common/entity-edit.sass\";import Select from\"../../components/Select\";import Checkbox from\"../../components/Checkbox\";import{useRoute}from\"react-router5\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var PermissionsPage_New=connect(mapStateToProps,mapDispatchToProps)(function(props){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),readyToSave=_useState2[0],setReadyToSave=_useState2[1];var $router=useRoute();var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),actions=_useState4[0],setActions=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),availableActions=_useState6[0],setAvailableActions=_useState6[1];var _useState7=useState(''),_useState8=_slicedToArray(_useState7,2),selectedAction=_useState8[0],setSelectedAction=_useState8[1];var _useState9=useState({name:'',actions:[]}),_useState10=_slicedToArray(_useState9,2),newPermissionData=_useState10[0],setNewPermissionData=_useState10[1];// Load info function\nfunction loadInfo(){return _loadInfo.apply(this,arguments);}// Load permission data\nfunction _loadInfo(){_loadInfo=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$axios$get,permissionsData;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return axios.get('/json/permissions.json');case 3:_yield$axios$get=_context.sent;permissionsData=_yield$axios$get.data;setActions(permissionsData.edit.actions);setAvailableActions([''].concat(permissionsData.edit.actions));setSelectedAction(availableActions[0]);setTimeout(function(){return setReadyToSave(false);},100);_context.next=14;break;case 11:_context.prev=11;_context.t0=_context[\"catch\"](0);nError(_context.t0);case 14:case\"end\":return _context.stop();}}},_callee,null,[[0,11]]);}));return _loadInfo.apply(this,arguments);}useEffect(function(){loadInfo();},[]);// Add action function\nfunction addAction(){if(!newPermissionData.actions||!newPermissionData)return;setNewPermissionData(_objectSpread(_objectSpread({},newPermissionData),{},{actions:[].concat(_toConsumableArray(newPermissionData.actions),[selectedAction])}));var _availableActions=_toConsumableArray(availableActions);_availableActions=_availableActions.filter(function(action){return!newPermissionData.actions.includes(action);});_availableActions.splice(_availableActions.findIndex(function(_action){return selectedAction===_action;}),1);setAvailableActions(_toConsumableArray(_availableActions));setSelectedAction(_availableActions[0]);setReadyToSave(true);}// Remove action function\nfunction removeAction(i){var _permissionActions=_toConsumableArray(newPermissionData.actions);var _action=_permissionActions[i];_permissionActions.splice(i,1);setNewPermissionData(_objectSpread(_objectSpread({},newPermissionData),{},{actions:_permissionActions}));setAvailableActions([].concat(_toConsumableArray(availableActions),[_action]));setReadyToSave(true);}useEffect(function(){return setReadyToSave(true);},[newPermissionData]);// Render function\nreturn/*#__PURE__*/_jsx(_Fragment,{children:availableActions?/*#__PURE__*/_jsxs(\"div\",{className:\"PermissionsPage_New entity-edit\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"wrapper flex-container sb\",children:/*#__PURE__*/_jsx(\"h1\",{children:\"New permission\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"fieldset\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"legend\",children:\"Main\"}),/*#__PURE__*/_jsx(\"div\",{className:\"fields\",children:/*#__PURE__*/_jsx(\"div\",{className:\"__left\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"field\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Name:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",onChange:function onChange(_ref){var value=_ref.target.value;return setNewPermissionData(_objectSpread(_objectSpread({},newPermissionData),{},{name:value}));}})]})})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"fieldset\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex-container sb wrap\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"legend\",children:\"Actions\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"legend-action-wrapper\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Action:\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"input-wrapper\",children:[/*#__PURE__*/_jsx(Select,{options:availableActions.map(function(action){return{span:action,value:action};}),selectedOption:selectedAction,onChange:function onChange(value){return setSelectedAction(value);}}),/*#__PURE__*/_jsx(\"button\",{disabled:!selectedAction,className:\"_green\",onClick:function onClick(){return addAction();},children:\"Add\"})]})]})]}),/*#__PURE__*/_jsxs(\"table\",{className:\"table som\",children:[/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{style:{width:'100%'},children:\"Action\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Allow\"}),/*#__PURE__*/_jsx(\"th\",{})]}),newPermissionData.actions.map(function(action,i){return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:action}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(Checkbox,{contents:'',value:true})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"button\",{className:\"_zeroed _iconed _red\",onClick:function onClick(){return removeAction(i);},children:/*#__PURE__*/_jsx(Icon,{icon:\"x-mark-1\"})})})]},i);})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"wrapper flex-container sb editing-buttons\",children:[/*#__PURE__*/_jsx(\"div\",{}),/*#__PURE__*/_jsxs(\"div\",{className:\"buttons\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"_bordered _red\",onClick:function onClick(){return $router.router.navigate('permissions',{},{reload:true});},children:\"Cancel\"}),/*#__PURE__*/_jsx(\"button\",{disabled:!readyToSave,className:\"_bordered _green\",children:\"Save\"})]})]})]}):null});});export default PermissionsPage_New;","map":{"version":3,"sources":["/Users/nicole/rrrr/crm/src/pages/Permissions/New.tsx"],"names":["axios","React","useEffect","useState","connect","Icon","nError","mapDispatchToProps","mapStateToProps","Select","Checkbox","useRoute","PermissionsPage_New","props","readyToSave","setReadyToSave","$router","actions","setActions","availableActions","setAvailableActions","selectedAction","setSelectedAction","name","newPermissionData","setNewPermissionData","loadInfo","get","permissionsData","data","edit","concat","setTimeout","addAction","_availableActions","filter","action","includes","splice","findIndex","_action","removeAction","i","_permissionActions","value","target","map","span","width","router","navigate","reload"],"mappings":"siBAAA,MAAOA,CAAAA,KAAP,KAAkB,OAAlB,CACA,MAAOC,CAAAA,KAAP,EAAgBC,SAAhB,CAA2BC,QAA3B,KAA2C,OAA3C,CACA,OAASC,OAAT,KAAwB,aAAxB,CACA,MAAOC,CAAAA,IAAP,KAAiB,uBAAjB,CACA,OAASC,MAAT,KAAuB,aAAvB,CAEA,OAAoCC,kBAApC,CAAwDC,eAAxD,KAA+E,aAA/E,CAGA,MAAO,4CAAP,CAEA,MAAOC,CAAAA,MAAP,KAAmB,yBAAnB,CACA,MAAOC,CAAAA,QAAP,KAAqB,2BAArB,CACA,OAASC,QAAT,KAAyB,eAAzB,C,6IAOA,GAAMC,CAAAA,mBAAmB,CAAGR,OAAO,CAACI,eAAD,CAAkBD,kBAAlB,CAAP,CAA6C,SAASM,KAAT,CAAuB,CAE9F,cAAsCV,QAAQ,CAAC,KAAD,CAA9C,wCAAOW,WAAP,eAAoBC,cAApB,eAEA,GAAMC,CAAAA,OAAO,CAAGL,QAAQ,EAAxB,CAEA,eAA8BR,QAAQ,CAAkB,IAAlB,CAAtC,yCAAOc,OAAP,eAAgBC,UAAhB,eACA,eAAgDf,QAAQ,CAAW,EAAX,CAAxD,yCAAOgB,gBAAP,eAAyBC,mBAAzB,eACA,eAA4CjB,QAAQ,CAAS,EAAT,CAApD,yCAAOkB,cAAP,eAAuBC,iBAAvB,eACA,eAAkDnB,QAAQ,CAAsB,CAC9EoB,IAAI,CAAE,EADwE,CAE9EN,OAAO,CAAE,EAFqE,CAAtB,CAA1D,0CAAOO,iBAAP,gBAA0BC,oBAA1B,gBAKA;AAd8F,QAe/EC,CAAAA,QAf+E,2CA8B9F;AA9B8F,uFAe9F,8MAE6C1B,CAAAA,KAAK,CAAC2B,GAAN,CAAU,wBAAV,CAF7C,uCAEkBC,eAFlB,kBAEYC,IAFZ,CAIIX,UAAU,CAACU,eAAe,CAACE,IAAhB,CAAqBb,OAAtB,CAAV,CACAG,mBAAmB,CAAC,CAAC,EAAD,EAAKW,MAAL,CAAYH,eAAe,CAACE,IAAhB,CAAqBb,OAAjC,CAAD,CAAnB,CACAK,iBAAiB,CAACH,gBAAgB,CAAC,CAAD,CAAjB,CAAjB,CAEAa,UAAU,CAAC,iBAAMjB,CAAAA,cAAc,CAAC,KAAD,CAApB,EAAD,CAA8B,GAA9B,CAAV,CARJ,iFAWIT,MAAM,aAAN,CAXJ,qEAf8F,2CA+B9FJ,SAAS,CAAC,UAAM,CACdwB,QAAQ,GACT,CAFQ,CAEN,EAFM,CAAT,CAIA;AACA,QAASO,CAAAA,SAAT,EAAqB,CAEnB,GAAG,CAACT,iBAAiB,CAACP,OAAnB,EAA8B,CAACO,iBAAlC,CAAqD,OAErDC,oBAAoB,gCACfD,iBADe,MAElBP,OAAO,8BACFO,iBAAiB,CAACP,OADhB,GAELI,cAFK,EAFW,GAApB,CAQA,GAAIa,CAAAA,iBAAiB,oBAAOf,gBAAP,CAArB,CAEAe,iBAAiB,CAAGA,iBAAiB,CAACC,MAAlB,CAAyB,SAACC,MAAD,QAAY,CAAEZ,iBAAiB,CAACP,OAAnB,CAAwCoB,QAAxC,CAAiDD,MAAjD,CAAb,EAAzB,CAApB,CACAF,iBAAiB,CAACI,MAAlB,CAAyBJ,iBAAiB,CAACK,SAAlB,CAA4B,SAACC,OAAD,QAAanB,CAAAA,cAAc,GAAKmB,OAAhC,EAA5B,CAAzB,CAA+F,CAA/F,EAEApB,mBAAmB,oBACdc,iBADc,EAAnB,CAIAZ,iBAAiB,CAACY,iBAAiB,CAAC,CAAD,CAAlB,CAAjB,CAEAnB,cAAc,CAAC,IAAD,CAAd,CACD,CAED;AACA,QAAS0B,CAAAA,YAAT,CAAsBC,CAAtB,CAAiC,CAE/B,GAAIC,CAAAA,kBAAkB,oBAAQnB,iBAAiB,CAACP,OAA1B,CAAtB,CAEA,GAAIuB,CAAAA,OAAO,CAAGG,kBAAkB,CAACD,CAAD,CAAhC,CAEAC,kBAAkB,CAACL,MAAnB,CAA0BI,CAA1B,CAA6B,CAA7B,EAEAjB,oBAAoB,gCACfD,iBADe,MAElBP,OAAO,CAAE0B,kBAFS,GAApB,CAKAvB,mBAAmB,8BACdD,gBADc,GAEjBqB,OAFiB,GAAnB,CAKAzB,cAAc,CAAC,IAAD,CAAd,CACD,CAEDb,SAAS,CAAC,iBAAMa,CAAAA,cAAc,CAAC,IAAD,CAApB,EAAD,CAA6B,CACpCS,iBADoC,CAA7B,CAAT,CAIA;AACA,mBAAQ,yBACLL,gBAAgB,cACf,aAAK,SAAS,CAAC,iCAAf,wBAEE,YAAK,SAAS,CAAC,2BAAf,uBACE,sCADF,EAFF,cAME,aAAK,SAAS,CAAC,UAAf,wBAEE,YAAK,SAAS,CAAC,QAAf,kBAFF,cAIE,YAAK,SAAS,CAAC,QAAf,uBAEE,YAAK,SAAS,CAAC,QAAf,uBACE,aAAK,SAAS,CAAC,OAAf,wBACE,+BADF,cAEE,cAAO,IAAI,CAAC,MAAZ,CAAmB,QAAQ,CAAE,2BAAWyB,CAAAA,KAAX,MAAEC,MAAF,CAAWD,KAAX,OAAuBnB,CAAAA,oBAAoB,gCAAKD,iBAAL,MAAwBD,IAAI,CAAEqB,KAA9B,GAA3C,EAA7B,EAFF,GADF,EAFF,EAJF,GANF,cAqBE,aAAK,SAAS,CAAC,UAAf,wBAEE,aAAK,SAAS,CAAC,wBAAf,wBACE,YAAK,SAAS,CAAC,QAAf,qBADF,cAGE,aAAK,SAAS,CAAC,uBAAf,wBACE,kCADF,cAEE,aAAK,SAAS,CAAC,eAAf,wBACE,KAAC,MAAD,EAAQ,OAAO,CAAEzB,gBAAgB,CAAC2B,GAAjB,CAAqB,SAACV,MAAD,QAAa,CACjDW,IAAI,CAAEX,MAD2C,CAEjDQ,KAAK,CAAER,MAF0C,CAAb,EAArB,CAAjB,CAGK,cAAc,CAAEf,cAHrB,CAGqC,QAAQ,CAAE,kBAACuB,KAAD,QAAWtB,CAAAA,iBAAiB,CAACsB,KAAD,CAA5B,EAH/C,EADF,cAKE,eAAQ,QAAQ,CAAE,CAACvB,cAAnB,CAAmC,SAAS,CAAC,QAA7C,CAAsD,OAAO,CAAE,yBAAMY,CAAAA,SAAS,EAAf,EAA/D,iBALF,GAFF,GAHF,GAFF,cAmBE,eAAO,SAAS,CAAC,WAAjB,wBACE,mCACE,WAAI,KAAK,CAAE,CAACe,KAAK,CAAE,MAAR,CAAX,oBADF,cAEE,6BAFF,cAGE,aAHF,GADF,CAMIxB,iBAAiB,CAACP,OAAnB,CAAwC6B,GAAxC,CAA4C,SAACV,MAAD,CAASM,CAAT,qBAC3C,mCACE,oBAAKN,MAAL,EADF,cAEE,iCACE,KAAC,QAAD,EAAU,QAAQ,CAAE,EAApB,CAAwB,KAAK,CAAE,IAA/B,EADF,EAFF,cAKE,iCACE,eAAQ,SAAS,CAAC,sBAAlB,CAAyC,OAAO,CAAE,yBAAMK,CAAAA,YAAY,CAACC,CAAD,CAAlB,EAAlD,uBACE,KAAC,IAAD,EAAM,IAAI,CAAC,UAAX,EADF,EADF,EALF,GAASA,CAAT,CAD2C,EAA5C,CANH,GAnBF,GArBF,cA8DE,aAAK,SAAS,CAAC,2CAAf,wBACE,cADF,cAEE,aAAK,SAAS,CAAC,SAAf,wBACE,eAAQ,SAAS,CAAC,gBAAlB,CAAmC,OAAO,CAAE,yBAAM1B,CAAAA,OAAO,CAACiC,MAAR,CAAeC,QAAf,CAAwB,aAAxB,CAAuC,EAAvC,CAA2C,CAC3FC,MAAM,CAAE,IADmF,CAA3C,CAAN,EAA5C,oBADF,cAME,eAAQ,QAAQ,CAAE,CAACrC,WAAnB,CAAgC,SAAS,CAAC,kBAA1C,kBANF,GAFF,GA9DF,GADe,CA6Eb,IA9EE,EAAR,CAgFD,CAzK2B,CAA5B,CA0KA,cAAeF,CAAAA,mBAAf","sourcesContent":["import axios from \"axios\"\nimport React, { useEffect, useState } from \"react\";\nimport { connect } from \"react-redux\";\nimport Icon from \"../../components/Icon\"\nimport { nError } from \"../../funcs\"\nimport Permission from \"../../models/Permission\"\nimport { StoreDispatch, StoreState, mapDispatchToProps, mapStateToProps } from \"../../store\";\nimport Datetime from 'react-datetime'\n\nimport \"../../styles/pages/common/entity-edit.sass\"\nimport moment from \"moment\"\nimport Select from \"../../components/Select\"\nimport Checkbox from \"../../components/Checkbox\"\nimport { useRoute } from \"react-router5\"\n\ninterface Props {\n  store: StoreState,\n  dispatcher: StoreDispatch\n}\n\nconst PermissionsPage_New = connect(mapStateToProps, mapDispatchToProps)(function(props: Props) {\n\n  const [readyToSave, setReadyToSave] = useState(false)\n\n  const $router = useRoute()\n\n  const [actions, setActions] = useState<string[] | null>(null)\n  const [availableActions, setAvailableActions] = useState<string[]>([])\n  const [selectedAction, setSelectedAction] = useState<string>('')\n  const [newPermissionData, setNewPermissionData] = useState<Partial<Permission>>({\n    name: '',\n    actions: [] as string[]\n  })\n  \n  // Load info function\n  async function loadInfo() {\n    try {\n      const { data: permissionsData } = (await axios.get('/json/permissions.json'))\n\n      setActions(permissionsData.edit.actions)\n      setAvailableActions([''].concat(permissionsData.edit.actions))\n      setSelectedAction(availableActions[0])\n\n      setTimeout(() => setReadyToSave(false), 100)\n    }\n    catch (error) {\n      nError(error)\n    }\n  }\n\n  // Load permission data\n  useEffect(() => {\n    loadInfo()\n  }, [])\n\n  // Add action function\n  function addAction() {\n\n    if(!newPermissionData.actions || !newPermissionData) return\n\n    setNewPermissionData({\n      ...newPermissionData,\n      actions: [\n        ...newPermissionData.actions,\n        selectedAction\n      ]\n    })\n\n    let _availableActions = [...availableActions]\n\n    _availableActions = _availableActions.filter((action) => !(newPermissionData.actions as string[]).includes(action))\n    _availableActions.splice(_availableActions.findIndex((_action) => selectedAction === _action), 1)\n\n    setAvailableActions([\n      ..._availableActions\n    ])\n\n    setSelectedAction(_availableActions[0])\n\n    setReadyToSave(true)\n  }\n\n  // Remove action function\n  function removeAction(i: number) {\n\n    let _permissionActions = [...(newPermissionData.actions as string[])]\n\n    let _action = _permissionActions[i]\n    \n    _permissionActions.splice(i, 1)\n\n    setNewPermissionData({\n      ...newPermissionData,\n      actions: _permissionActions\n    })\n\n    setAvailableActions([\n      ...availableActions,\n      _action\n    ])\n\n    setReadyToSave(true)\n  }\n\n  useEffect(() => setReadyToSave(true), [\n    newPermissionData\n  ])\n  \n  // Render function\n  return (<>\n    {availableActions ? (\n      <div className=\"PermissionsPage_New entity-edit\">\n\n        <div className=\"wrapper flex-container sb\">\n          <h1>New permission</h1>\n        </div>\n        \n        <div className=\"fieldset\">\n          \n          <div className=\"legend\">Main</div>\n\n          <div className=\"fields\">\n\n            <div className=\"__left\">\n              <div className=\"field\">\n                <span>Name:</span>\n                <input type=\"text\" onChange={({target: {value}}) => setNewPermissionData({...newPermissionData, name: value})} />\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"fieldset\">\n\n          <div className=\"flex-container sb wrap\">\n            <div className=\"legend\">Actions</div>\n\n            <div className=\"legend-action-wrapper\">\n              <label>Action:</label>\n              <div className=\"input-wrapper\">\n                <Select options={availableActions.map((action) => ({\n                  span: action,\n                  value: action\n                }))} selectedOption={selectedAction} onChange={(value) => setSelectedAction(value as string)}/>\n                <button disabled={!selectedAction} className=\"_green\" onClick={() => addAction()}>\n                  Add\n                </button>\n              </div>\n            </div>\n          </div>\n\n          <table className=\"table som\">\n            <tr>\n              <th style={{width: '100%'}}>Action</th>\n              <th>Allow</th>\n              <th></th>\n            </tr>\n            {(newPermissionData.actions as string[]).map((action, i) => (\n              <tr key={i}>\n                <td>{action}</td>\n                <td>\n                  <Checkbox contents={''} value={true} />\n                </td>\n                <td>\n                  <button className=\"_zeroed _iconed _red\" onClick={() => removeAction(i)}>\n                    <Icon icon=\"x-mark-1\" />\n                  </button>\n                </td>\n              </tr>\n            ))}\n          </table>\n        </div>\n\n        <div className=\"wrapper flex-container sb editing-buttons\">\n          <div />\n          <div className=\"buttons\">\n            <button className=\"_bordered _red\" onClick={() => $router.router.navigate('permissions', {}, {\n              reload: true\n            })}>\n              Cancel\n            </button>\n            <button disabled={!readyToSave} className=\"_bordered _green\">\n              Save\n            </button>\n          </div>\n        </div>\n      </div>\n    ) : null}\n  </>)\n})\nexport default PermissionsPage_New\n"]},"metadata":{},"sourceType":"module"}