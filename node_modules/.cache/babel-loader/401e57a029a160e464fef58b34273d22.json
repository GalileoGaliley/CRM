{"ast":null,"code":"import _toConsumableArray from\"/Users/nicole/rrrr/crm/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _objectSpread from\"/Users/nicole/rrrr/crm/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/Users/nicole/rrrr/crm/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/nicole/rrrr/crm/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/nicole/rrrr/crm/node_modules/@babel/runtime/regenerator/index.js\";import axios from\"axios\";import React,{useEffect,useState}from\"react\";import{connect}from\"react-redux\";import Icon from\"../../components/Icon\";import{nError}from\"../../funcs\";import{mapDispatchToProps,mapStateToProps}from\"../../store\";import\"../../styles/pages/common/entity-edit.sass\";import Select from\"../../components/Select\";import Checkbox from\"../../components/Checkbox\";import{useRoute}from\"react-router5\";import classNames from\"classnames\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var AccountPermissionsPage_Item=connect(mapStateToProps,mapDispatchToProps)(function(props){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),readyToSave=_useState2[0],setReadyToSave=_useState2[1];var $router=useRoute();var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),deleting=_useState4[0],setDeleting=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),readyToDelete=_useState6[0],setReadyToDelete=_useState6[1];var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),permissionData=_useState8[0],setAccountPermissionData=_useState8[1];var _useState9=useState(''),_useState10=_slicedToArray(_useState9,2),selectedAction=_useState10[0],setSelectedAction=_useState10[1];var _useState11=useState({name:'',accounts:'',actions:[]}),_useState12=_slicedToArray(_useState11,2),newAccountPermissionData=_useState12[0],setNewAccountPermissionData=_useState12[1];var _useState13=useState([]),_useState14=_slicedToArray(_useState13,2),availableActions=_useState14[0],setAvailableActions=_useState14[1];// Load info function\nfunction loadInfo(){return _loadInfo.apply(this,arguments);}// Load permission data\nfunction _loadInfo(){_loadInfo=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _ref2,_permissionData,_availableActions;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return axios.get('/json/account_permission.json');case 3:_ref2=_context.sent;_permissionData=_ref2.data;_availableActions=[''].concat(_permissionData.edit.actions.filter(function(action){return!_permissionData.permission.actions.includes(action);}));setAccountPermissionData(_permissionData);setAvailableActions(_availableActions);setSelectedAction(_availableActions[0]);setNewAccountPermissionData(_objectSpread(_objectSpread({},newAccountPermissionData),{},{actions:_permissionData.permission.actions}));setTimeout(function(){return setReadyToSave(false);},100);_context.next=16;break;case 13:_context.prev=13;_context.t0=_context[\"catch\"](0);nError(_context.t0);case 16:case\"end\":return _context.stop();}}},_callee,null,[[0,13]]);}));return _loadInfo.apply(this,arguments);}useEffect(function(){loadInfo();},[]);// Add action function\nfunction addAction(){if(!newAccountPermissionData.actions||!permissionData||!newAccountPermissionData)return;setNewAccountPermissionData(_objectSpread(_objectSpread({},newAccountPermissionData),{},{actions:[].concat(_toConsumableArray(newAccountPermissionData.actions),[selectedAction])}));var _availableActions=_toConsumableArray(permissionData===null||permissionData===void 0?void 0:permissionData.edit.actions);_availableActions=permissionData.edit.actions.filter(function(action){return!newAccountPermissionData.actions.includes(action);});_availableActions.splice(_availableActions.findIndex(function(_action){return selectedAction===_action;}),1);setAvailableActions(_toConsumableArray(_availableActions));setSelectedAction('');setReadyToSave(true);}// Remove action function\nfunction removeAction(i){var _permissionActions=_toConsumableArray(newAccountPermissionData.actions);var _action=_permissionActions[i];_permissionActions.splice(i,1);setNewAccountPermissionData(_objectSpread(_objectSpread({},newAccountPermissionData),{},{actions:_permissionActions}));setAvailableActions([].concat(_toConsumableArray(availableActions),[_action]));setReadyToSave(true);}useEffect(function(){return setReadyToSave(true);},[newAccountPermissionData]);// Render function\nreturn/*#__PURE__*/_jsx(_Fragment,{children:permissionData&&newAccountPermissionData?/*#__PURE__*/_jsxs(\"div\",{className:\"AccountPermissionsPage_Item entity-edit\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"wrapper flex-container sb\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex-container _gap-narrow\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Account`s Permission:\"}),/*#__PURE__*/_jsx(\"div\",{className:\"item-name\",children:permissionData.permission.name})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"fieldset\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"legend\",children:\"Main\"}),/*#__PURE__*/_jsx(\"div\",{className:\"fields\",children:/*#__PURE__*/_jsx(\"div\",{className:\"__left\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"field\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Name:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",defaultValue:permissionData.permission.name,onChange:function onChange(_ref){var value=_ref.target.value;return setNewAccountPermissionData(_objectSpread(_objectSpread({},newAccountPermissionData),{},{name:value}));}})]})})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"fieldset\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex-container sb wrap\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"legend\",children:\"Actions\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"legend-action-wrapper\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Action:\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"input-wrapper\",children:[/*#__PURE__*/_jsx(Select,{options:availableActions.map(function(action){return{span:action,value:action};}),selectedOption:selectedAction,onChange:function onChange(value){return setSelectedAction(value);}}),/*#__PURE__*/_jsx(\"button\",{disabled:!selectedAction,className:\"_green\",onClick:function onClick(){return addAction();},children:\"Add\"})]})]})]}),/*#__PURE__*/_jsxs(\"table\",{className:\"table som\",children:[/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{style:{width:'100%'},children:\"Action\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Allow\"}),/*#__PURE__*/_jsx(\"th\",{})]}),newAccountPermissionData.actions.map(function(action,i){return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:action}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(Checkbox,{contents:'',value:true})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"button\",{className:\"_zeroed _iconed _red\",onClick:function onClick(){return removeAction(i);},children:/*#__PURE__*/_jsx(Icon,{icon:\"x-mark-1\"})})})]},i);})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"fieldset\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"legend\",children:\"Info\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"fields\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"__left\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"field\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Date Created:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",defaultValue:newAccountPermissionData.created_at,disabled:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"field\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Created by:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",defaultValue:newAccountPermissionData.created_by,disabled:true})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"__right\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"field\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Last Edited:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",defaultValue:newAccountPermissionData.last_edited_at,disabled:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"field\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Last Edited By:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",defaultValue:newAccountPermissionData.last_edited_by,disabled:true})]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"fieldset\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"legend\",children:\"Accounts\"}),/*#__PURE__*/_jsxs(\"table\",{className:\"table\",children:[/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"Name\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Owner\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Status\"})]}),permissionData.accounts.map(function(account,i){return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:account.Name}),/*#__PURE__*/_jsx(\"td\",{children:account.owner}),/*#__PURE__*/_jsx(\"td\",{className:classNames({'red-text':account.status==='Inactive','green-text':account.status==='Active','blue-text':!['Inactive','Active'].includes(account.status)}),children:account.status})]},i);})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"wrapper flex-container sb editing-buttons\",children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"button\",{className:\"_red\",onClick:function onClick(){return setDeleting(true);},children:\"Delete Account`s Permission\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"buttons\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"_bordered _red\",onClick:function onClick(){return $router.router.navigate('accounts_permissions',{},{reload:true});},children:\"Cancel\"}),/*#__PURE__*/_jsx(\"button\",{disabled:!readyToSave,className:\"_bordered _green\",children:\"Save\"})]})]}),deleting?/*#__PURE__*/_jsx(\"div\",{className:\"item-delete-popup\",onClick:function onClick(){return setDeleting(false);},children:/*#__PURE__*/_jsxs(\"div\",{className:\"wrapper\",onClick:function onClick(e){return e.stopPropagation();},children:[/*#__PURE__*/_jsx(\"div\",{className:\"title\",children:\"Delete Account`s Permission\"}),/*#__PURE__*/_jsx(\"div\",{className:\"checkbox-wrapper\",children:/*#__PURE__*/_jsx(Checkbox,{contents:\"I understand that after deleting the account`s permission it will not be possible to recover.\",value:readyToDelete,onChange:function onChange(value){return setReadyToDelete(value);}})}),/*#__PURE__*/_jsxs(\"div\",{className:\"buttons\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"_bordered _green\",onClick:function onClick(){return setDeleting(false);},children:\"Cancel\"}),/*#__PURE__*/_jsx(\"button\",{disabled:!readyToDelete,className:\"_bordered _red\",children:\"Delete\"})]})]})}):null]}):null});});export default AccountPermissionsPage_Item;","map":{"version":3,"sources":["/Users/nicole/rrrr/crm/src/pages/AccountPermissions/Item.tsx"],"names":["axios","React","useEffect","useState","connect","Icon","nError","mapDispatchToProps","mapStateToProps","Select","Checkbox","useRoute","classNames","AccountPermissionsPage_Item","props","readyToSave","setReadyToSave","$router","deleting","setDeleting","readyToDelete","setReadyToDelete","permissionData","setAccountPermissionData","selectedAction","setSelectedAction","name","accounts","actions","newAccountPermissionData","setNewAccountPermissionData","availableActions","setAvailableActions","loadInfo","get","data","_availableActions","concat","edit","filter","action","permission","includes","setTimeout","addAction","splice","findIndex","_action","removeAction","i","_permissionActions","value","target","map","span","width","created_at","created_by","last_edited_at","last_edited_by","account","Name","owner","status","router","navigate","reload","e","stopPropagation"],"mappings":"siBAAA,MAAOA,CAAAA,KAAP,KAAkB,OAAlB,CACA,MAAOC,CAAAA,KAAP,EAAgBC,SAAhB,CAA2BC,QAA3B,KAA2C,OAA3C,CACA,OAASC,OAAT,KAAwB,aAAxB,CACA,MAAOC,CAAAA,IAAP,KAAiB,uBAAjB,CACA,OAASC,MAAT,KAAuB,aAAvB,CAEA,OAAoCC,kBAApC,CAAwDC,eAAxD,KAA+E,aAA/E,CAGA,MAAO,4CAAP,CAEA,MAAOC,CAAAA,MAAP,KAAmB,yBAAnB,CACA,MAAOC,CAAAA,QAAP,KAAqB,2BAArB,CACA,OAASC,QAAT,KAAyB,eAAzB,CAEA,MAAOC,CAAAA,UAAP,KAAuB,YAAvB,C,6IAuBA,GAAMC,CAAAA,2BAA2B,CAAGT,OAAO,CAACI,eAAD,CAAkBD,kBAAlB,CAAP,CAA6C,SAASO,KAAT,CAAuB,CAEtG,cAAsCX,QAAQ,CAAC,KAAD,CAA9C,wCAAOY,WAAP,eAAoBC,cAApB,eAEA,GAAMC,CAAAA,OAAO,CAAGN,QAAQ,EAAxB,CAEA,eAAgCR,QAAQ,CAAC,KAAD,CAAxC,yCAAOe,QAAP,eAAiBC,WAAjB,eACA,eAA0ChB,QAAQ,CAAC,KAAD,CAAlD,yCAAOiB,aAAP,eAAsBC,gBAAtB,eAEA,eAAmDlB,QAAQ,CAA+B,IAA/B,CAA3D,yCAAOmB,cAAP,eAAuBC,wBAAvB,eAEA,eAA4CpB,QAAQ,CAAS,EAAT,CAApD,0CAAOqB,cAAP,gBAAuBC,iBAAvB,gBAEA,gBAAgEtB,QAAQ,CAA6B,CACnGuB,IAAI,CAAE,EAD6F,CAEnGC,QAAQ,CAAE,EAFyF,CAGnGC,OAAO,CAAE,EAH0F,CAA7B,CAAxE,2CAAOC,wBAAP,gBAAiCC,2BAAjC,gBAMA,gBAAgD3B,QAAQ,CAAW,EAAX,CAAxD,2CAAO4B,gBAAP,gBAAyBC,mBAAzB,gBAEA;AArBsG,QAsBvFC,CAAAA,QAtBuF,2CA2CtG;AA3CsG,uFAsBtG,qNAE4CjC,CAAAA,KAAK,CAACkC,GAAN,CAAU,+BAAV,CAF5C,4BAEkBZ,eAFlB,OAEYa,IAFZ,CAIQC,iBAJR,CAI4B,CAAC,EAAD,EAAKC,MAAL,CAAYf,eAAc,CAACgB,IAAf,CAAoBV,OAApB,CAA4BW,MAA5B,CAAmC,SAACC,MAAD,QAAY,CAAClB,eAAc,CAACmB,UAAf,CAA0Bb,OAA1B,CAAkCc,QAAlC,CAA2CF,MAA3C,CAAb,EAAnC,CAAZ,CAJ5B,CAMIjB,wBAAwB,CAACD,eAAD,CAAxB,CACAU,mBAAmB,CAACI,iBAAD,CAAnB,CACAX,iBAAiB,CAACW,iBAAiB,CAAC,CAAD,CAAlB,CAAjB,CACAN,2BAA2B,gCACtBD,wBADsB,MAEzBD,OAAO,CAAEN,eAAc,CAACmB,UAAf,CAA0Bb,OAFV,GAA3B,CAKAe,UAAU,CAAC,iBAAM3B,CAAAA,cAAc,CAAC,KAAD,CAApB,EAAD,CAA8B,GAA9B,CAAV,CAdJ,iFAiBIV,MAAM,aAAN,CAjBJ,qEAtBsG,2CA4CtGJ,SAAS,CAAC,UAAM,CACd+B,QAAQ,GACT,CAFQ,CAEN,EAFM,CAAT,CAIA;AACA,QAASW,CAAAA,SAAT,EAAqB,CAEnB,GAAG,CAACf,wBAAwB,CAACD,OAA1B,EAAqC,CAACN,cAAtC,EAAwD,CAACO,wBAA5D,CAAsF,OAEtFC,2BAA2B,gCACtBD,wBADsB,MAEzBD,OAAO,8BACFC,wBAAwB,CAACD,OADvB,GAELJ,cAFK,EAFkB,GAA3B,CAQA,GAAIY,CAAAA,iBAAiB,oBAAOd,cAAP,SAAOA,cAAP,iBAAOA,cAAc,CAAEgB,IAAhB,CAAqBV,OAA5B,CAArB,CAEAQ,iBAAiB,CAAGd,cAAc,CAACgB,IAAf,CAAoBV,OAApB,CAA4BW,MAA5B,CAAmC,SAACC,MAAD,QAAY,CAAEX,wBAAwB,CAACD,OAA1B,CAA+Cc,QAA/C,CAAwDF,MAAxD,CAAb,EAAnC,CAApB,CACAJ,iBAAiB,CAACS,MAAlB,CAAyBT,iBAAiB,CAACU,SAAlB,CAA4B,SAACC,OAAD,QAAavB,CAAAA,cAAc,GAAKuB,OAAhC,EAA5B,CAAzB,CAA+F,CAA/F,EAEAf,mBAAmB,oBACdI,iBADc,EAAnB,CAIAX,iBAAiB,CAAC,EAAD,CAAjB,CAEAT,cAAc,CAAC,IAAD,CAAd,CACD,CAED;AACA,QAASgC,CAAAA,YAAT,CAAsBC,CAAtB,CAAiC,CAE/B,GAAIC,CAAAA,kBAAkB,oBAAQrB,wBAAwB,CAACD,OAAjC,CAAtB,CAEA,GAAImB,CAAAA,OAAO,CAAGG,kBAAkB,CAACD,CAAD,CAAhC,CAEAC,kBAAkB,CAACL,MAAnB,CAA0BI,CAA1B,CAA6B,CAA7B,EAEAnB,2BAA2B,gCACtBD,wBADsB,MAEzBD,OAAO,CAAEsB,kBAFgB,GAA3B,CAKAlB,mBAAmB,8BACdD,gBADc,GAEjBgB,OAFiB,GAAnB,CAKA/B,cAAc,CAAC,IAAD,CAAd,CACD,CAEDd,SAAS,CAAC,iBAAMc,CAAAA,cAAc,CAAC,IAAD,CAApB,EAAD,CAA6B,CACpCa,wBADoC,CAA7B,CAAT,CAIA;AACA,mBAAQ,yBACLP,cAAc,EAAIO,wBAAlB,cACC,aAAK,SAAS,CAAC,yCAAf,wBAEE,YAAK,SAAS,CAAC,2BAAf,uBACE,aAAK,SAAS,CAAC,4BAAf,wBACE,6CADF,cAEE,YAAK,SAAS,CAAC,WAAf,UACGP,cAAc,CAACmB,UAAf,CAA0Bf,IAD7B,EAFF,GADF,EAFF,cAWE,aAAK,SAAS,CAAC,UAAf,wBAEE,YAAK,SAAS,CAAC,QAAf,kBAFF,cAIE,YAAK,SAAS,CAAC,QAAf,uBAEE,YAAK,SAAS,CAAC,QAAf,uBACE,aAAK,SAAS,CAAC,OAAf,wBACE,+BADF,cAEE,cAAO,IAAI,CAAC,MAAZ,CAAmB,YAAY,CAAEJ,cAAc,CAACmB,UAAf,CAA0Bf,IAA3D,CAAiE,QAAQ,CAAE,2BAAWyB,CAAAA,KAAX,MAAEC,MAAF,CAAWD,KAAX,OAAuBrB,CAAAA,2BAA2B,gCAAKD,wBAAL,MAA+BH,IAAI,CAAEyB,KAArC,GAAlD,EAA3E,EAFF,GADF,EAFF,EAJF,GAXF,cA0BE,aAAK,SAAS,CAAC,UAAf,wBAEE,aAAK,SAAS,CAAC,wBAAf,wBACE,YAAK,SAAS,CAAC,QAAf,qBADF,cAGE,aAAK,SAAS,CAAC,uBAAf,wBACE,kCADF,cAEE,aAAK,SAAS,CAAC,eAAf,wBACE,KAAC,MAAD,EAAQ,OAAO,CAAEpB,gBAAgB,CAACsB,GAAjB,CAAqB,SAACb,MAAD,QAAa,CACjDc,IAAI,CAAEd,MAD2C,CAEjDW,KAAK,CAAEX,MAF0C,CAAb,EAArB,CAAjB,CAGK,cAAc,CAAEhB,cAHrB,CAGqC,QAAQ,CAAE,kBAAC2B,KAAD,QAAW1B,CAAAA,iBAAiB,CAAC0B,KAAD,CAA5B,EAH/C,EADF,cAKE,eAAQ,QAAQ,CAAE,CAAC3B,cAAnB,CAAmC,SAAS,CAAC,QAA7C,CAAsD,OAAO,CAAE,yBAAMoB,CAAAA,SAAS,EAAf,EAA/D,iBALF,GAFF,GAHF,GAFF,cAmBE,eAAO,SAAS,CAAC,WAAjB,wBACE,mCACE,WAAI,KAAK,CAAE,CAACW,KAAK,CAAE,MAAR,CAAX,oBADF,cAEE,6BAFF,cAGE,aAHF,GADF,CAMI1B,wBAAwB,CAACD,OAA1B,CAA+CyB,GAA/C,CAAmD,SAACb,MAAD,CAASS,CAAT,qBAClD,mCACE,oBAAKT,MAAL,EADF,cAEE,iCACE,KAAC,QAAD,EAAU,QAAQ,CAAE,EAApB,CAAwB,KAAK,CAAE,IAA/B,EADF,EAFF,cAKE,iCACE,eAAQ,SAAS,CAAC,sBAAlB,CAAyC,OAAO,CAAE,yBAAMQ,CAAAA,YAAY,CAACC,CAAD,CAAlB,EAAlD,uBACE,KAAC,IAAD,EAAM,IAAI,CAAC,UAAX,EADF,EADF,EALF,GAASA,CAAT,CADkD,EAAnD,CANH,GAnBF,GA1BF,cAmEE,aAAK,SAAS,CAAC,UAAf,wBAEE,YAAK,SAAS,CAAC,QAAf,kBAFF,cAIE,aAAK,SAAS,CAAC,QAAf,wBAEE,aAAK,SAAS,CAAC,QAAf,wBACE,aAAK,SAAS,CAAC,OAAf,wBACE,uCADF,cAEE,cAAO,IAAI,CAAC,MAAZ,CAAmB,YAAY,CAAEpB,wBAAwB,CAAC2B,UAA1D,CAAsE,QAAQ,CAAG,IAAjF,EAFF,GADF,cAME,aAAK,SAAS,CAAC,OAAf,wBACE,qCADF,cAEE,cAAO,IAAI,CAAC,MAAZ,CAAmB,YAAY,CAAE3B,wBAAwB,CAAC4B,UAA1D,CAAsE,QAAQ,CAAG,IAAjF,EAFF,GANF,GAFF,cAeE,aAAK,SAAS,CAAC,SAAf,wBAEE,aAAK,SAAS,CAAC,OAAf,wBACE,sCADF,cAEE,cAAO,IAAI,CAAC,MAAZ,CAAmB,YAAY,CAAE5B,wBAAwB,CAAC6B,cAA1D,CAA0E,QAAQ,CAAG,IAArF,EAFF,GAFF,cAOE,aAAK,SAAS,CAAC,OAAf,wBACE,yCADF,cAEE,cAAO,IAAI,CAAC,MAAZ,CAAmB,YAAY,CAAE7B,wBAAwB,CAAC8B,cAA1D,CAA0E,QAAQ,CAAG,IAArF,EAFF,GAPF,GAfF,GAJF,GAnEF,cAqGE,aAAK,SAAS,CAAC,UAAf,wBAEE,YAAK,SAAS,CAAC,QAAf,sBAFF,cAIE,eAAO,SAAS,CAAC,OAAjB,wBACE,mCACE,4BADF,cAEE,6BAFF,cAGE,8BAHF,GADF,CAMGrC,cAAc,CAACK,QAAf,CAAwB0B,GAAxB,CAA4B,SAACO,OAAD,CAAUX,CAAV,qBAC3B,mCACE,oBAAKW,OAAO,CAACC,IAAb,EADF,cAEE,oBAAKD,OAAO,CAACE,KAAb,EAFF,cAGE,WAAI,SAAS,CAAElD,UAAU,CAAC,CACxB,WAAYgD,OAAO,CAACG,MAAR,GAAmB,UADP,CAExB,aAAcH,OAAO,CAACG,MAAR,GAAmB,QAFT,CAGxB,YAAa,CAAC,CAAC,UAAD,CAAa,QAAb,EAAuBrB,QAAvB,CAAgCkB,OAAO,CAACG,MAAxC,CAHU,CAAD,CAAzB,UAIKH,OAAO,CAACG,MAJb,EAHF,GAASd,CAAT,CAD2B,EAA5B,CANH,GAJF,GArGF,cA6HE,aAAK,SAAS,CAAC,2CAAf,wBACE,kCACE,eAAQ,SAAS,CAAC,MAAlB,CAAyB,OAAO,CAAE,yBAAM9B,CAAAA,WAAW,CAAC,IAAD,CAAjB,EAAlC,yCADF,EADF,cAIE,aAAK,SAAS,CAAC,SAAf,wBACE,eAAQ,SAAS,CAAC,gBAAlB,CAAmC,OAAO,CAAE,yBAAMF,CAAAA,OAAO,CAAC+C,MAAR,CAAeC,QAAf,CAAwB,sBAAxB,CAAgD,EAAhD,CAAoD,CACpGC,MAAM,CAAE,IAD4F,CAApD,CAAN,EAA5C,oBADF,cAME,eAAQ,QAAQ,CAAE,CAACnD,WAAnB,CAAgC,SAAS,CAAC,kBAA1C,kBANF,GAJF,GA7HF,CA8IGG,QAAQ,cACP,YAAK,SAAS,CAAC,mBAAf,CAAmC,OAAO,CAAE,yBAAMC,CAAAA,WAAW,CAAC,KAAD,CAAjB,EAA5C,uBAEE,aAAK,SAAS,CAAC,SAAf,CAAyB,OAAO,CAAE,iBAACgD,CAAD,QAAOA,CAAAA,CAAC,CAACC,eAAF,EAAP,EAAlC,wBAEE,YAAK,SAAS,CAAC,OAAf,yCAFF,cAME,YAAK,SAAS,CAAC,kBAAf,uBACE,KAAC,QAAD,EAAU,QAAQ,CAAC,+FAAnB,CAAmH,KAAK,CAAEhD,aAA1H,CAAyI,QAAQ,CAAE,kBAAC+B,KAAD,QAAW9B,CAAAA,gBAAgB,CAAC8B,KAAD,CAA3B,EAAnJ,EADF,EANF,cAUE,aAAK,SAAS,CAAC,SAAf,wBAEE,eAAQ,SAAS,CAAC,kBAAlB,CAAqC,OAAO,CAAE,yBAAMhC,CAAAA,WAAW,CAAC,KAAD,CAAjB,EAA9C,oBAFF,cAME,eAAQ,QAAQ,CAAE,CAACC,aAAnB,CAAkC,SAAS,CAAC,gBAA5C,oBANF,GAVF,GAFF,EADO,CAyBL,IAvKN,GADD,CA0KG,IA3KE,EAAR,CA6KD,CAnRmC,CAApC,CAoRA,cAAeP,CAAAA,2BAAf","sourcesContent":["import axios from \"axios\"\nimport React, { useEffect, useState } from \"react\";\nimport { connect } from \"react-redux\";\nimport Icon from \"../../components/Icon\"\nimport { nError } from \"../../funcs\"\nimport AccountPermission from \"../../models/AccountPermission\"\nimport { StoreDispatch, StoreState, mapDispatchToProps, mapStateToProps } from \"../../store\";\nimport Datetime from 'react-datetime'\n\nimport \"../../styles/pages/common/entity-edit.sass\"\nimport moment from \"moment\"\nimport Select from \"../../components/Select\"\nimport Checkbox from \"../../components/Checkbox\"\nimport { useRoute } from \"react-router5\"\nimport PermissionAccount from \"../../models/PermissionAccount\"\nimport classNames from \"classnames\"\n\ninterface Props {\n  store: StoreState,\n  dispatcher: StoreDispatch\n}\n\ninterface AccountPermissionData {\n\n\tpermissions: {\n\t\tedit_account_permission: boolean,\n\t\tshow_account: boolean\n  },\n  \n  permission: AccountPermission,\n  \n  accounts: PermissionAccount[],\n  \n\tedit: {\n\t\tactions: string[]\n\t}\n}\n\nconst AccountPermissionsPage_Item = connect(mapStateToProps, mapDispatchToProps)(function(props: Props) {\n\n  const [readyToSave, setReadyToSave] = useState(false)\n\n  const $router = useRoute()\n\n  const [deleting, setDeleting] = useState(false)\n  const [readyToDelete, setReadyToDelete] = useState(false)\n  \n  const [permissionData, setAccountPermissionData] = useState<AccountPermissionData | null>(null)\n\n  const [selectedAction, setSelectedAction] = useState<string>('')\n\n  const [newAccountPermissionData, setNewAccountPermissionData] = useState<Partial<AccountPermission>>({\n    name: '',\n    accounts: '',\n    actions: [] as string[]\n  })\n\n  const [availableActions, setAvailableActions] = useState<string[]>([])\n\n  // Load info function\n  async function loadInfo() {\n    try {\n      const { data: permissionData } = (await axios.get('/json/account_permission.json')) as {data: AccountPermissionData}\n\n      let _availableActions = [''].concat(permissionData.edit.actions.filter((action) => !permissionData.permission.actions.includes(action)))\n\n      setAccountPermissionData(permissionData)\n      setAvailableActions(_availableActions)\n      setSelectedAction(_availableActions[0])\n      setNewAccountPermissionData({\n        ...newAccountPermissionData,\n        actions: permissionData.permission.actions\n      })\n\n      setTimeout(() => setReadyToSave(false), 100)\n    }\n    catch (error) {\n      nError(error)\n    }\n  }\n\n  // Load permission data\n  useEffect(() => {\n    loadInfo()\n  }, [])\n\n  // Add action function\n  function addAction() {\n\n    if(!newAccountPermissionData.actions || !permissionData || !newAccountPermissionData) return\n\n    setNewAccountPermissionData({\n      ...newAccountPermissionData,\n      actions: [\n        ...newAccountPermissionData.actions,\n        selectedAction\n      ]\n    })\n\n    let _availableActions = [...permissionData?.edit.actions]\n\n    _availableActions = permissionData.edit.actions.filter((action) => !(newAccountPermissionData.actions as string[]).includes(action))\n    _availableActions.splice(_availableActions.findIndex((_action) => selectedAction === _action), 1)\n\n    setAvailableActions([\n      ..._availableActions\n    ])\n\n    setSelectedAction('')\n\n    setReadyToSave(true)\n  }\n\n  // Remove action function\n  function removeAction(i: number) {\n\n    let _permissionActions = [...(newAccountPermissionData.actions as string[])]\n\n    let _action = _permissionActions[i]\n    \n    _permissionActions.splice(i, 1)\n\n    setNewAccountPermissionData({\n      ...newAccountPermissionData,\n      actions: _permissionActions\n    })\n\n    setAvailableActions([\n      ...availableActions,\n      _action\n    ])\n\n    setReadyToSave(true)\n  }\n\n  useEffect(() => setReadyToSave(true), [\n    newAccountPermissionData\n  ])\n  \n  // Render function\n  return (<>\n    {permissionData && newAccountPermissionData ? (\n      <div className=\"AccountPermissionsPage_Item entity-edit\">\n\n        <div className=\"wrapper flex-container sb\">\n          <div className=\"flex-container _gap-narrow\">\n            <h1>Account`s Permission:</h1>\n            <div className=\"item-name\">\n              {permissionData.permission.name}\n            </div>\n          </div>\n        </div>\n        \n        <div className=\"fieldset\">\n          \n          <div className=\"legend\">Main</div>\n\n          <div className=\"fields\">\n\n            <div className=\"__left\">\n              <div className=\"field\">\n                <span>Name:</span>\n                <input type=\"text\" defaultValue={permissionData.permission.name} onChange={({target: {value}}) => setNewAccountPermissionData({...newAccountPermissionData, name: value})} />\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"fieldset\">\n\n          <div className=\"flex-container sb wrap\">\n            <div className=\"legend\">Actions</div>\n\n            <div className=\"legend-action-wrapper\">\n              <label>Action:</label>\n              <div className=\"input-wrapper\">\n                <Select options={availableActions.map((action) => ({\n                  span: action,\n                  value: action\n                }))} selectedOption={selectedAction} onChange={(value) => setSelectedAction(value as string)}/>\n                <button disabled={!selectedAction} className=\"_green\" onClick={() => addAction()}>\n                  Add\n                </button>\n              </div>\n            </div>\n          </div>\n\n          <table className=\"table som\">\n            <tr>\n              <th style={{width: '100%'}}>Action</th>\n              <th>Allow</th>\n              <th></th>\n            </tr>\n            {(newAccountPermissionData.actions as string[]).map((action, i) => (\n              <tr key={i}>\n                <td>{action}</td>\n                <td>\n                  <Checkbox contents={''} value={true} />\n                </td>\n                <td>\n                  <button className=\"_zeroed _iconed _red\" onClick={() => removeAction(i)}>\n                    <Icon icon=\"x-mark-1\" />\n                  </button>\n                </td>\n              </tr>\n            ))}\n          </table>\n        </div>\n\n        <div className=\"fieldset\">\n          \n          <div className=\"legend\">Info</div>\n\n          <div className=\"fields\">\n\n            <div className=\"__left\">\n              <div className=\"field\">\n                <span>Date Created:</span>\n                <input type=\"text\" defaultValue={newAccountPermissionData.created_at} disabled={ true } />\n              </div>\n\n              <div className=\"field\">\n                <span>Created by:</span>\n                <input type=\"text\" defaultValue={newAccountPermissionData.created_by} disabled={ true } />\n              </div>\n            </div>\n\n            \n            <div className=\"__right\">\n\n              <div className=\"field\">\n                <span>Last Edited:</span>\n                <input type=\"text\" defaultValue={newAccountPermissionData.last_edited_at} disabled={ true } />\n              </div>\n\n              <div className=\"field\">\n                <span>Last Edited By:</span>\n                <input type=\"text\" defaultValue={newAccountPermissionData.last_edited_by} disabled={ true } />\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"fieldset\">\n\n          <div className=\"legend\">Accounts</div>\n\n          <table className=\"table\">\n            <tr>\n              <th>Name</th>\n              <th>Owner</th>\n              <th>Status</th>\n            </tr>\n            {permissionData.accounts.map((account, i) => (\n              <tr key={i}>\n                <td>{account.Name}</td>\n                <td>{account.owner}</td>\n                <td className={classNames({\n                  'red-text': account.status === 'Inactive',\n                  'green-text': account.status === 'Active',\n                  'blue-text': !['Inactive', 'Active'].includes(account.status)\n                })}>{account.status}</td>\n              </tr>\n            ))}\n          </table>\n        </div>\n\n        <div className=\"wrapper flex-container sb editing-buttons\">\n          <div>\n            <button className=\"_red\" onClick={() => setDeleting(true)}>Delete Account`s Permission</button>\n          </div>\n          <div className=\"buttons\">\n            <button className=\"_bordered _red\" onClick={() => $router.router.navigate('accounts_permissions', {}, {\n              reload: true\n            })}>\n              Cancel\n            </button>\n            <button disabled={!readyToSave} className=\"_bordered _green\">\n              Save\n            </button>\n          </div>\n        </div>\n\n        {/* Item delete popup */}\n        {deleting ? (\n          <div className=\"item-delete-popup\" onClick={() => setDeleting(false)}>\n\n            <div className=\"wrapper\" onClick={(e) => e.stopPropagation()}>\n            \n              <div className=\"title\">\n                Delete Account`s Permission\n              </div>\n\n              <div className=\"checkbox-wrapper\">\n                <Checkbox contents=\"I understand that after deleting the account`s permission it will not be possible to recover.\" value={readyToDelete} onChange={(value) => setReadyToDelete(value)} />\n              </div>\n\n              <div className=\"buttons\">\n\n                <button className=\"_bordered _green\" onClick={() => setDeleting(false)}>\n                  Cancel\n                </button>\n\n                <button disabled={!readyToDelete} className=\"_bordered _red\">\n                  Delete\n                </button>\n              </div>\n            </div>\n          </div>\n        ) : null}\n      </div>\n    ) : null}\n  </>)\n})\nexport default AccountPermissionsPage_Item\n"]},"metadata":{},"sourceType":"module"}