{"ast":null,"code":"import _objectSpread from\"/Users/nicole/rrrr/crm/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/Users/nicole/rrrr/crm/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/nicole/rrrr/crm/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/nicole/rrrr/crm/node_modules/@babel/runtime/regenerator/index.js\";import axios from\"axios\";import React,{useEffect,useState}from\"react\";import{connect}from\"react-redux\";import{nError}from\"../../funcs\";import{mapDispatchToProps,mapStateToProps}from\"../../store\";import\"../../styles/pages/common/entity-edit.sass\";import moment from\"moment\";import Select from\"../../components/Select\";import{useRoute}from\"react-router5\";import{DateTime}from\"luxon\";import DateTimeComponent from\"react-datetime\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var AbsencesPage_New=connect(mapStateToProps,mapDispatchToProps)(function(props){var $router=useRoute();var _useState=useState(false),_useState2=_slicedToArray(_useState,2),readyToSave=_useState2[0],setReadyToSave=_useState2[1];var _useState3=useState({service_resource:'',area:'',absence_start:DateTime.now().plus({hours:1}).set({minute:0}).toJSDate(),absence_end:DateTime.now().plus({hours:1}).set({minute:0}).toJSDate()}),_useState4=_slicedToArray(_useState3,2),newAbsenceData=_useState4[0],setNewAbsenceData=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),absenceDataEdit=_useState6[0],setNewAbsenceDataEdit=_useState6[1];// Load info function\nfunction loadInfo(){return _loadInfo.apply(this,arguments);}// Load absence data\nfunction _loadInfo(){_loadInfo=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$axios$get,absenceData;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return axios.get('/json/absences.json');case 3:_yield$axios$get=_context.sent;absenceData=_yield$axios$get.data;setNewAbsenceDataEdit(absenceData.edit);setTimeout(function(){return setReadyToSave(false);},100);_context.next=12;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](0);nError(_context.t0);case 12:case\"end\":return _context.stop();}}},_callee,null,[[0,9]]);}));return _loadInfo.apply(this,arguments);}useEffect(function(){loadInfo();},[]);useEffect(function(){return setReadyToSave(true);},[newAbsenceData]);// Handle service resource changing\nuseEffect(function(){var _absenceDataEdit$find;var sr=newAbsenceData.service_resource;if(!absenceDataEdit)return;setNewAbsenceData(_objectSpread(_objectSpread({},newAbsenceData),{},{area:(_absenceDataEdit$find=absenceDataEdit.find(function(item){return item.service_resource===sr;}))===null||_absenceDataEdit$find===void 0?void 0:_absenceDataEdit$find.area}));},[newAbsenceData.service_resource]);// Render function\nreturn/*#__PURE__*/_jsx(_Fragment,{children:absenceDataEdit?/*#__PURE__*/_jsxs(\"div\",{className:\"AbsencesPage_Item AbsencePage_New entity-edit\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"wrapper flex-container sb\",children:/*#__PURE__*/_jsx(\"h1\",{children:\"Absence\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"fieldset\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"legend\",children:\"Main\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"fields\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"__left\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"field\",style:{zIndex:6},children:[/*#__PURE__*/_jsx(\"span\",{children:\"Service resource:\"}),/*#__PURE__*/_jsx(Select,{options:absenceDataEdit.map(function(option){return{span:option.service_resource,value:option.service_resource};}),selectedOption:newAbsenceData.service_resource,onChange:function onChange(value){return setNewAbsenceData(_objectSpread(_objectSpread({},newAbsenceData),{},{service_resource:value}));}})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"field\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Area:\"}),/*#__PURE__*/_jsx(Select,{disabled:true,options:absenceDataEdit.map(function(option){return{span:option.area,value:option.area};}),selectedOption:newAbsenceData.area,onChange:function onChange(value){return 2;}})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"__right\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"field\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Absence start:\"}),/*#__PURE__*/_jsx(DateTimeComponent,{value:newAbsenceData.absence_start,onChange:function onChange(value){return setNewAbsenceData(_objectSpread(_objectSpread({},newAbsenceData),{},{absence_start:moment.isMoment(value)?value.toDate():newAbsenceData.absence_start}));}})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"field\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Absence end:\"}),/*#__PURE__*/_jsx(DateTimeComponent,{value:newAbsenceData.absence_end,onChange:function onChange(value){return setNewAbsenceData(_objectSpread(_objectSpread({},newAbsenceData),{},{absence_end:moment.isMoment(value)?value.toDate():newAbsenceData.absence_end}));}})]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"wrapper flex-container sb editing-buttons\",children:[/*#__PURE__*/_jsx(\"div\",{}),/*#__PURE__*/_jsxs(\"div\",{className:\"buttons\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"_bordered _red\",onClick:function onClick(){return $router.router.navigate('absences',{},{reload:true});},children:\"Cancel\"}),/*#__PURE__*/_jsx(\"button\",{disabled:!readyToSave,className:\"_bordered _green\",children:\"Save\"})]})]})]}):null});});export default AbsencesPage_New;","map":{"version":3,"sources":["/Users/nicole/rrrr/crm/src/pages/Absences/New.tsx"],"names":["axios","React","useEffect","useState","connect","nError","mapDispatchToProps","mapStateToProps","moment","Select","useRoute","DateTime","DateTimeComponent","AbsencesPage_New","props","$router","readyToSave","setReadyToSave","service_resource","area","absence_start","now","plus","hours","set","minute","toJSDate","absence_end","newAbsenceData","setNewAbsenceData","absenceDataEdit","setNewAbsenceDataEdit","loadInfo","get","absenceData","data","edit","setTimeout","sr","find","item","zIndex","map","option","span","value","isMoment","toDate","router","navigate","reload"],"mappings":"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","sourcesContent":["import axios from \"axios\"\nimport React, { useEffect, useState } from \"react\";\nimport { connect } from \"react-redux\";\nimport Icon from \"../../components/Icon\"\nimport { nError } from \"../../funcs\"\nimport Absence from \"../../models/Absence\"\nimport { StoreDispatch, StoreState, mapDispatchToProps, mapStateToProps } from \"../../store\";\n\nimport \"../../styles/pages/common/entity-edit.sass\"\nimport moment from \"moment\"\nimport Select from \"../../components/Select\"\nimport Checkbox from \"../../components/Checkbox\"\nimport { useRoute } from \"react-router5\"\nimport { DateTime } from \"luxon\"\n\nimport DateTimeComponent from \"react-datetime\"\n\ninterface Props {\n  store: StoreState,\n  dispatcher: StoreDispatch\n}\n\nconst AbsencesPage_New = connect(mapStateToProps, mapDispatchToProps)(function(props: Props) {\n\n  const $router = useRoute()\n\n  const [readyToSave, setReadyToSave] = useState(false)\n  \n  const [newAbsenceData, setNewAbsenceData] = useState<Partial<Absence>>({\n    service_resource: '',\n    area: '',\n    absence_start: DateTime.now().plus({hours: 1}).set({minute: 0}).toJSDate(),\n    absence_end: DateTime.now().plus({hours: 1}).set({minute: 0}).toJSDate()\n  })\n\n  const [absenceDataEdit, setNewAbsenceDataEdit] = useState<{\n    service_resource: string,\n    area: string\n  }[] | null>(null)\n  \n  // Load info function\n  async function loadInfo() {\n    try {\n      const { data: absenceData } = (await axios.get('/json/absences.json'))\n\n      setNewAbsenceDataEdit(absenceData.edit)\n\n      setTimeout(() => setReadyToSave(false), 100)\n    }\n    catch (error) {\n      nError(error)\n    }\n  }\n\n  // Load absence data\n  useEffect(() => {\n    loadInfo()\n  }, [])\n\n  useEffect(() => setReadyToSave(true), [\n    newAbsenceData\n  ])\n\n  // Handle service resource changing\n  useEffect(() => {\n\n    let sr = newAbsenceData.service_resource\n\n    if(!absenceDataEdit) return\n    \n    setNewAbsenceData({\n      ...newAbsenceData,\n      area: absenceDataEdit.find((item) => item.service_resource === sr)?.area as string\n    })\n\n  }, [newAbsenceData.service_resource])\n  \n  // Render function\n  return (<>\n    {absenceDataEdit ? (\n      <div className=\"AbsencesPage_Item AbsencePage_New entity-edit\">\n\n        <div className=\"wrapper flex-container sb\">\n          <h1>Absence</h1>\n        </div>\n        \n        <div className=\"fieldset\">\n          \n          <div className=\"legend\">Main</div>\n\n          <div className=\"fields\">\n\n            <div className=\"__left\">\n              <div className=\"field\" style={{zIndex: 6}}>\n                <span>Service resource:</span>\n                <Select options={absenceDataEdit.map((option) => ({\n                  span: option.service_resource,\n                  value: option.service_resource\n                }))} selectedOption={newAbsenceData.service_resource as string} onChange={(value) => setNewAbsenceData({...newAbsenceData, service_resource: value as string})}/>\n              </div>\n\n              <div className=\"field\">\n                <span>Area:</span>\n                <Select disabled={true} options={absenceDataEdit.map((option) => ({\n                  span: option.area,\n                  value: option.area\n                }))} selectedOption={newAbsenceData.area as string} onChange={(value) => 2}/>\n              </div>\n            </div>\n\n            \n            <div className=\"__right\">\n\n              <div className=\"field\">\n                <span>Absence start:</span>\n                <DateTimeComponent value={newAbsenceData.absence_start as Date} onChange={(value) => setNewAbsenceData({...newAbsenceData, absence_start: moment.isMoment(value) ? value.toDate() : newAbsenceData.absence_start})} />\n              </div>\n\n              <div className=\"field\">\n                <span>Absence end:</span>\n                <DateTimeComponent value={newAbsenceData.absence_end as Date} onChange={(value) => setNewAbsenceData({...newAbsenceData, absence_end: moment.isMoment(value) ? value.toDate() : newAbsenceData.absence_end})} />\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"wrapper flex-container sb editing-buttons\">\n          <div></div>\n          <div className=\"buttons\">\n            <button className=\"_bordered _red\" onClick={() => $router.router.navigate('absences', {}, {reload: true})}>\n              Cancel\n            </button>\n            <button disabled={!readyToSave} className=\"_bordered _green\">\n              Save\n            </button>\n          </div>\n        </div>\n      </div>\n    ) : null}\n  </>)\n})\nexport default AbsencesPage_New\n"]},"metadata":{},"sourceType":"module"}